function cchl_enableFilters(element){var eventos=jQuery("div.evento",element);eventos.show();var avevs=[],evsarr=[],temevs=[],temsarr=[];eventos.each(function(){var evs=jQuery(this).data("cchl_tipoevento"),tems=jQuery(this).data("cchl_temaevento");if(void 0!==evs){evsarr=evs.split(" ");for(var i=0,l=evsarr.length;i<l;i++)-1==jQuery.inArray(evsarr[i],avevs)&&avevs.push(evsarr[i])}if(void 0!==tems){temsarr=tems.split(" ");for(var i=0,l=temsarr.length;i<l;i++)-1==jQuery.inArray(temsarr[i],temevs)&&temevs.push(temsarr[i])}});var filtro=jQuery("div.filtro"),filtrotema=jQuery("div.filtrotema");avevs.sort(),temevs.sort(),filtro.empty(),filtrotema.empty();for(var i=0,l=avevs.length;i<l;i++)filtro.append('<a class="fltip" href="javascript:void(0);" data-tiposw="'+avevs[i]+'">'+cchl.evtipos[avevs[i]]+"</a>");for(var i=0,l=temevs.length;i<l;i++)void 0!==cchl.evtemas[temevs[i]]&&filtrotema.append('<a class="fltem" href="javascript:void(0);" data-tiposw="'+temevs[i]+'">'+cchl.evtemas[temevs[i]]+"</a>");jQuery("div.filtrotab",element).hide(),jQuery("div.filtrotab.active",element).show(),jQuery(".filtronav a",element).on("click",function(event){event.preventDefault(),eventos.show(),jQuery("div.filtrotema a, div.filtro a",element).removeClass("on");var active=jQuery(".filtronav a.active",element);jQuery(".filtrotab.active",element).hide().removeClass("active"),active.removeClass("active"),thisdatafilter=jQuery(this).attr("data-relfilter"),jQuery('.filtrotab[data-filter="'+thisdatafilter+'"]',element).show().addClass("active"),jQuery(this).addClass("active")});var lidiaaltura=jQuery(element).height();jQuery("ul.calendario-filsa").height(lidiaaltura),jQuery('a.fltip:contains("undefined"), a.fltem:contains("undefined")').hide()}!function($,window,Galleria,undef){var doc=window.document,$doc=$(doc),$win=$(window),protoArray=Array.prototype,DEBUG=!0,TIMEOUT=3e4,DUMMY=!1,NAV=navigator.userAgent.toLowerCase(),HASH=window.location.hash.replace(/#\//,""),PROT=window.location.protocol,M=Math,F=function(){},FALSE=function(){return!1},IE=function(){var v=3,div=doc.createElement("div"),all=div.getElementsByTagName("i");do{div.innerHTML="\x3c!--[if gt IE "+ ++v+"]><i></i><![endif]--\x3e"}while(all[0]);return v>4?v:doc.documentMode||undef}(),DOM=function(){return{html:doc.documentElement,body:doc.body,head:doc.getElementsByTagName("head")[0],title:doc.title}},IFRAME=window.parent!==window.self,_eventlist="data ready thumbnail loadstart loadfinish image play pause progress fullscreen_enter fullscreen_exit idle_enter idle_exit rescale lightbox_open lightbox_close lightbox_image",_events=function(){var evs=[];return $.each(_eventlist.split(" "),function(i,ev){evs.push(ev),/_/.test(ev)&&evs.push(ev.replace(/_/g,""))}),evs}(),_legacyOptions=function(options){var n;return"object"!=typeof options?options:($.each(options,function(key,value){/^[a-z]+_/.test(key)&&(n="",$.each(key.split("_"),function(i,k){n+=i>0?k.substr(0,1).toUpperCase()+k.substr(1):k}),options[n]=value,delete options[key])}),options)},_patchEvent=function(type){return $.inArray(type,_events)>-1?Galleria[type.toUpperCase()]:type},_video={youtube:{reg:/https?:\/\/(?:[a-zA_Z]{2,3}.)?(?:youtube\.com\/watch\?)((?:[\w\d\-\_\=]+&amp;(?:amp;)?)*v(?:&lt;[A-Z]+&gt;)?=([0-9a-zA-Z\-\_]+))/i,embed:function(){return"http://www.youtube.com/embed/"+this.id},getUrl:function(){return PROT+"//gdata.youtube.com/feeds/api/videos/"+this.id+"?v=2&alt=json-in-script&callback=?"},get_thumb:function(data){return data.entry.media$group.media$thumbnail[2].url},get_image:function(data){return data.entry.yt$hd?PROT+"//img.youtube.com/vi/"+this.id+"/maxresdefault.jpg":data.entry.media$group.media$thumbnail[3].url}},vimeo:{reg:/https?:\/\/(?:www\.)?(vimeo\.com)\/(?:hd#)?([0-9]+)/i,embed:function(){return"http://player.vimeo.com/video/"+this.id},getUrl:function(){return PROT+"//vimeo.com/api/v2/video/"+this.id+".json?callback=?"},get_thumb:function(data){return data[0].thumbnail_medium},get_image:function(data){return data[0].thumbnail_large}},dailymotion:{reg:/https?:\/\/(?:www\.)?(dailymotion\.com)\/video\/([^_]+)/,embed:function(){return PROT+"//www.dailymotion.com/embed/video/"+this.id},getUrl:function(){return"https://api.dailymotion.com/video/"+this.id+"?fields=thumbnail_240_url,thumbnail_720_url&callback=?"},get_thumb:function(data){return data.thumbnail_240_url},get_image:function(data){return data.thumbnail_720_url}},_inst:[]},Video=function(type,id){for(var i=0;i<_video._inst.length;i++)if(_video._inst[i].id===id&&_video._inst[i].type==type)return _video._inst[i];this.type=type,this.id=id,this.readys=[],_video._inst.push(this);var self=this;$.extend(this,_video[type]),$.getJSON(this.getUrl(),function(data){self.data=data,$.each(self.readys,function(i,fn){fn(self.data)}),self.readys=[]}),this.getMedia=function(type,callback,fail){fail=fail||F;var self=this,success=function(data){callback(self["get_"+type](data))};try{self.data?success(self.data):self.readys.push(success)}catch(e){fail()}}},_videoTest=function(url){var match;for(var v in _video)if((match=url&&_video[v].reg&&url.match(_video[v].reg))&&match.length)return{id:match[2],provider:v};return!1},_nativeFullscreen={support:function(){var html=DOM().html;return!IFRAME&&(html.requestFullscreen||html.msRequestFullscreen||html.mozRequestFullScreen||html.webkitRequestFullScreen)}(),callback:F,enter:function(instance,callback,elem){this.instance=instance,this.callback=callback||F,elem=elem||DOM().html,elem.requestFullscreen?elem.requestFullscreen():elem.msRequestFullscreen?elem.msRequestFullscreen():elem.mozRequestFullScreen?elem.mozRequestFullScreen():elem.webkitRequestFullScreen&&elem.webkitRequestFullScreen()},exit:function(callback){this.callback=callback||F,doc.exitFullscreen?doc.exitFullscreen():doc.msExitFullscreen?doc.msExitFullscreen():doc.mozCancelFullScreen?doc.mozCancelFullScreen():doc.webkitCancelFullScreen&&doc.webkitCancelFullScreen()},instance:null,listen:function(){if(this.support){var handler=function(){if(_nativeFullscreen.instance){var fs=_nativeFullscreen.instance._fullscreen;doc.fullscreen||doc.mozFullScreen||doc.webkitIsFullScreen||doc.msFullscreenElement&&null!==doc.msFullscreenElement?fs._enter(_nativeFullscreen.callback):fs._exit(_nativeFullscreen.callback)}};doc.addEventListener("fullscreenchange",handler,!1),doc.addEventListener("MSFullscreenChange",handler,!1),doc.addEventListener("mozfullscreenchange",handler,!1),doc.addEventListener("webkitfullscreenchange",handler,!1)}}},_galleries=[],_instances=[],_hasError=!1,_canvas=!1,_pool=[],_loadedThemes=[],_themeLoad=function(theme){_loadedThemes.push(theme),$.each(_pool,function(i,instance){instance._options.theme!=theme.name&&(instance._initialized||instance._options.theme)||(instance.theme=theme,instance._init.call(instance))})},Utils=function(){return{clearTimer:function(id){$.each(Galleria.get(),function(){this.clearTimer(id)})},addTimer:function(id){$.each(Galleria.get(),function(){this.addTimer(id)})},array:function(obj){return protoArray.slice.call(obj,0)},create:function(className,nodeName){nodeName=nodeName||"div";var elem=doc.createElement(nodeName);return elem.className=className,elem},removeFromArray:function(arr,elem){return $.each(arr,function(i,el){if(el==elem)return arr.splice(i,1),!1}),arr},getScriptPath:function(src){src=src||$("script:last").attr("src");var slices=src.split("/");return 1==slices.length?"":(slices.pop(),slices.join("/")+"/")},animate:function(){var change,strings,easing,syntax,revert,form,css,transition=function(style){var i,props="transition WebkitTransition MozTransition OTransition".split(" ");if(window.opera)return!1;for(i=0;props[i];i++)if(void 0!==style[props[i]])return props[i];return!1}((doc.body||doc.documentElement).style),endEvent={MozTransition:"transitionend",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",transition:"transitionend"}[transition],easings={_default:[.25,.1,.25,1],galleria:[.645,.045,.355,1],galleriaIn:[.55,.085,.68,.53],galleriaOut:[.25,.46,.45,.94],ease:[.25,0,.25,1],linear:[.25,.25,.75,.75],"ease-in":[.42,0,1,1],"ease-out":[0,0,.58,1],"ease-in-out":[.42,0,.58,1]},setStyle=function(elem,value,suffix){var css={};suffix=suffix||"transition",$.each("webkit moz ms o".split(" "),function(){css["-"+this+"-"+suffix]=value}),elem.css(css)},clearStyle=function(elem){setStyle(elem,"none","transition"),Galleria.WEBKIT&&Galleria.TOUCH&&(setStyle(elem,"translate3d(0,0,0)","transform"),elem.data("revert")&&(elem.css(elem.data("revert")),elem.data("revert",null)))};return function(elem,to,options){return options=$.extend({duration:400,complete:F,stop:!1},options),elem=$(elem),options.duration?transition?(options.stop&&(elem.off(endEvent),clearStyle(elem)),change=!1,$.each(to,function(key,val){css=elem.css(key),Utils.parseValue(css)!=Utils.parseValue(val)&&(change=!0),elem.css(key,css)}),change?(strings=[],easing=options.easing in easings?easings[options.easing]:easings._default,syntax=" "+options.duration+"ms cubic-bezier("+easing.join(",")+")",void window.setTimeout(function(elem,endEvent,to,syntax){return function(){elem.one(endEvent,function(elem){return function(){clearStyle(elem),options.complete.call(elem[0])}}(elem)),Galleria.WEBKIT&&Galleria.TOUCH&&(revert={},form=[0,0,0],$.each(["left","top"],function(i,m){m in to&&(form[i]=Utils.parseValue(to[m])-Utils.parseValue(elem.css(m))+"px",revert[m]=to[m],delete to[m])}),(form[0]||form[1])&&(elem.data("revert",revert),strings.push("-webkit-transform"+syntax),setStyle(elem,"translate3d("+form.join(",")+")","transform"))),$.each(to,function(p,val){strings.push(p+syntax)}),setStyle(elem,strings.join(",")),elem.css(to)}}(elem,endEvent,to,syntax),2)):void window.setTimeout(function(){options.complete.call(elem[0])},options.duration)):void elem.animate(to,options):(elem.css(to),void options.complete.call(elem[0]))}}(),removeAlpha:function(elem){if(elem instanceof jQuery&&(elem=elem[0]),IE<9&&elem){var style=elem.style,currentStyle=elem.currentStyle,filter=currentStyle&&currentStyle.filter||style.filter||"";/alpha/.test(filter)&&(style.filter=filter.replace(/alpha\([^)]*\)/i,""))}},forceStyles:function(elem,styles){elem=$(elem),elem.attr("style")&&elem.data("styles",elem.attr("style")).removeAttr("style"),elem.css(styles)},revertStyles:function(){$.each(Utils.array(arguments),function(i,elem){elem=$(elem),elem.removeAttr("style"),elem.attr("style",""),elem.data("styles")&&elem.attr("style",elem.data("styles")).data("styles",null)})},moveOut:function(elem){Utils.forceStyles(elem,{position:"absolute",left:-1e4})},moveIn:function(){Utils.revertStyles.apply(Utils,Utils.array(arguments))},hide:function(elem,speed,callback){callback=callback||F;var $elem=$(elem);elem=$elem[0],$elem.data("opacity")||$elem.data("opacity",$elem.css("opacity"));var style={opacity:0};if(speed){var complete=IE<9&&elem?function(){Utils.removeAlpha(elem),elem.style.visibility="hidden",callback.call(elem)}:callback;Utils.animate(elem,style,{duration:speed,complete:complete,stop:!0})}else IE<9&&elem?(Utils.removeAlpha(elem),elem.style.visibility="hidden"):$elem.css(style)},show:function(elem,speed,callback){callback=callback||F;var $elem=$(elem);elem=$elem[0];var saved=parseFloat($elem.data("opacity"))||1,style={opacity:saved};if(speed){IE<9&&($elem.css("opacity",0),elem.style.visibility="visible");var complete=IE<9&&elem?function(){1==style.opacity&&Utils.removeAlpha(elem),callback.call(elem)}:callback;Utils.animate(elem,style,{duration:speed,complete:complete,stop:!0})}else IE<9&&1==style.opacity&&elem?(Utils.removeAlpha(elem),elem.style.visibility="visible"):$elem.css(style)},wait:function(options){Galleria._waiters=Galleria._waiters||[],options=$.extend({until:FALSE,success:F,error:function(){Galleria.raise("Could not complete wait function.")},timeout:3e3},options);var elapsed,now,tid,start=Utils.timestamp(),fn=function(){return now=Utils.timestamp(),elapsed=now-start,Utils.removeFromArray(Galleria._waiters,tid),options.until(elapsed)?(options.success(),!1):"number"==typeof options.timeout&&now>=start+options.timeout?(options.error(),!1):void Galleria._waiters.push(tid=window.setTimeout(fn,10))};Galleria._waiters.push(tid=window.setTimeout(fn,10))},toggleQuality:function(img,force){7!==IE&&8!==IE||!img||"IMG"!=img.nodeName.toUpperCase()||(void 0===force&&(force="nearest-neighbor"===img.style.msInterpolationMode),img.style.msInterpolationMode=force?"bicubic":"nearest-neighbor")},insertStyleTag:function(styles,id){if(!id||!$("#"+id).length){var style=doc.createElement("style");if(id&&(style.id=id),DOM().head.appendChild(style),style.styleSheet)style.styleSheet.cssText=styles;else{var cssText=doc.createTextNode(styles);style.appendChild(cssText)}}},loadScript:function(url,callback){var done=!1,script=$("<script>").attr({src:url,async:!0}).get(0);script.onload=script.onreadystatechange=function(){done||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(done=!0,script.onload=script.onreadystatechange=null,"function"==typeof callback&&callback.call(this,this))},DOM().head.appendChild(script)},parseValue:function(val){if("number"==typeof val)return val;if("string"==typeof val){var arr=val.match(/\-?\d|\./g);return arr&&arr.constructor===Array?1*arr.join(""):0}return 0},timestamp:function(){return(new Date).getTime()},loadCSS:function(href,id,callback){var link,length;if($("link[rel=stylesheet]").each(function(){if(new RegExp(href).test(this.href))return link=this,!1}),"function"==typeof id&&(callback=id,id=undef),callback=callback||F,link)return callback.call(link,link),link;if(length=doc.styleSheets.length,$("#"+id).length)$("#"+id).attr("href",href),length--;else{link=$("<link>").attr({rel:"stylesheet",href:href,id:id}).get(0);var styles=$('link[rel="stylesheet"], style');if(styles.length?styles.get(0).parentNode.insertBefore(link,styles[0]):DOM().head.appendChild(link),IE&&length>=31)return void Galleria.raise("You have reached the browser stylesheet limit (31)",!0)}if("function"==typeof callback){var $loader=$("<s>").attr("id","galleria-loader").hide().appendTo(DOM().body);Utils.wait({until:function(){return 1==$loader.height()},success:function(){$loader.remove(),callback.call(link,link)},error:function(){$loader.remove(),Galleria.raise("Theme CSS could not load after 20 sec. "+(Galleria.QUIRK?"Your browser is in Quirks Mode, please add a correct doctype.":"Please download the latest theme at http://galleria.io/customer/."),!0)},timeout:5e3})}return link}}}(),_playIcon=function(container){return Utils.insertStyleTag(".galleria-videoicon{width:60px;height:60px;position:absolute;top:50%;left:50%;z-index:1;margin:-30px 0 0 -30px;cursor:pointer;background:#000;background:rgba(0,0,0,.8);border-radius:3px;-webkit-transition:all 150ms}.galleria-videoicon i{width:0px;height:0px;border-style:solid;border-width:10px 0 10px 16px;display:block;border-color:transparent transparent transparent #ffffff;margin:20px 0 0 22px}.galleria-image:hover .galleria-videoicon{background:#000}","galleria-videoicon"),$(Utils.create("galleria-videoicon")).html("<i></i>").appendTo(container).click(function(){$(this).siblings("img").mouseup()})},_transitions=function(){var _slide=function(params,complete,fade,door){var easing=this.getOptions("easing"),distance=this.getStageWidth(),from={left:distance*(params.rewind?-1:1)},to={left:0};fade?(from.opacity=0,to.opacity=1):from.opacity=1,$(params.next).css(from),Utils.animate(params.next,to,{duration:params.speed,complete:function(elems){return function(){complete(),elems.css({left:0})}}($(params.next).add(params.prev)),queue:!1,easing:easing}),door&&(params.rewind=!params.rewind),params.prev&&(from={left:0},to={left:distance*(params.rewind?1:-1)},fade&&(from.opacity=1,to.opacity=0),$(params.prev).css(from),Utils.animate(params.prev,to,{duration:params.speed,queue:!1,easing:easing,complete:function(){$(this).css("opacity",0)}}))};return{active:!1,init:function(effect,params,complete){_transitions.effects.hasOwnProperty(effect)&&_transitions.effects[effect].call(this,params,complete)},effects:{fade:function(params,complete){$(params.next).css({opacity:0,left:0}),Utils.animate(params.next,{opacity:1},{duration:params.speed,complete:complete}),params.prev&&($(params.prev).css("opacity",1).show(),Utils.animate(params.prev,{opacity:0},{duration:params.speed}))},flash:function(params,complete){$(params.next).css({opacity:0,left:0}),params.prev?Utils.animate(params.prev,{opacity:0},{duration:params.speed/2,complete:function(){Utils.animate(params.next,{opacity:1},{duration:params.speed,complete:complete})}}):Utils.animate(params.next,{opacity:1},{duration:params.speed,complete:complete})},pulse:function(params,complete){params.prev&&$(params.prev).hide(),$(params.next).css({opacity:0,left:0}).show(),Utils.animate(params.next,{opacity:1},{duration:params.speed,complete:complete})},slide:function(params,complete){_slide.apply(this,Utils.array(arguments))},fadeslide:function(params,complete){_slide.apply(this,Utils.array(arguments).concat([!0]))},doorslide:function(params,complete){_slide.apply(this,Utils.array(arguments).concat([!1,!0]))}}}}();_nativeFullscreen.listen(),$.event.special["click:fast"]={propagate:!0,add:function(handleObj){var getCoords=function(e){if(e.touches&&e.touches.length){var touch=e.touches[0];return{x:touch.pageX,y:touch.pageY}}},def={touched:!1,touchdown:!1,coords:{x:0,y:0},evObj:{}};$(this).data({clickstate:def,timer:0}).on("touchstart.fast",function(e){window.clearTimeout($(this).data("timer")),$(this).data("clickstate",{touched:!0,touchdown:!0,coords:getCoords(e.originalEvent),evObj:e})}).on("touchmove.fast",function(e){var coords=getCoords(e.originalEvent),state=$(this).data("clickstate");Math.max(Math.abs(state.coords.x-coords.x),Math.abs(state.coords.y-coords.y))>6&&$(this).data("clickstate",$.extend(state,{touchdown:!1}))}).on("touchend.fast",function(e){var $this=$(this);$this.data("clickstate").touchdown&&handleObj.handler.call(this,e),$this.data("timer",window.setTimeout(function(){$this.data("clickstate",def)},400))}).on("click.fast",function(e){if($(this).data("clickstate").touched)return!1;$(this).data("clickstate",def),handleObj.handler.call(this,e)})},remove:function(){$(this).off("touchstart.fast touchmove.fast touchend.fast click.fast")}},$win.on("orientationchange",function(){$(this).resize()}),Galleria=function(){var self=this;this._options={},this._playing=!1,this._playtime=5e3,this._active=null,this._queue={length:0},this._data=[],this._dom={},this._thumbnails=[],this._layers=[],this._initialized=!1,this._firstrun=!1,this._stageWidth=0,this._stageHeight=0,this._target=undef,this._binds=[],this._id=parseInt(1e4*M.random(),10),$.each("container stage images image-nav image-nav-left image-nav-right info info-text info-title info-description thumbnails thumbnails-list thumbnails-container thumb-nav-left thumb-nav-right loader counter tooltip".split(" "),function(i,elemId){self._dom[elemId]=Utils.create("galleria-"+elemId)}),$.each("current total".split(" "),function(i,elemId){self._dom[elemId]=Utils.create("galleria-"+elemId,"span")});var keyboard=this._keyboard={keys:{UP:38,DOWN:40,LEFT:37,RIGHT:39,RETURN:13,ESCAPE:27,BACKSPACE:8,SPACE:32},map:{},bound:!1,press:function(e){var key=e.keyCode||e.which;key in keyboard.map&&"function"==typeof keyboard.map[key]&&keyboard.map[key].call(self,e)},attach:function(map){var key,up;for(key in map)map.hasOwnProperty(key)&&(up=key.toUpperCase(),up in keyboard.keys?keyboard.map[keyboard.keys[up]]=map[key]:keyboard.map[up]=map[key]);keyboard.bound||(keyboard.bound=!0,$doc.on("keydown",keyboard.press))},detach:function(){keyboard.bound=!1,keyboard.map={},$doc.off("keydown",keyboard.press)}},controls=this._controls={0:undef,1:undef,active:0,swap:function(){controls.active=controls.active?0:1},getActive:function(){return self._options.swipe?controls.slides[self._active]:controls[controls.active]},getNext:function(){return self._options.swipe?controls.slides[self.getNext(self._active)]:controls[1-controls.active]},slides:[],frames:[],layers:[]},carousel=this._carousel={next:self.$("thumb-nav-right"),prev:self.$("thumb-nav-left"),width:0,current:0,max:0,hooks:[],update:function(){var w=0,h=0,hooks=[0];$.each(self._thumbnails,function(i,thumb){if(thumb.ready){w+=thumb.outerWidth||$(thumb.container).outerWidth(!0);var containerWidth=$(thumb.container).width();w+=containerWidth-M.floor(containerWidth),hooks[i+1]=w,h=M.max(h,thumb.outerHeight||$(thumb.container).outerHeight(!0))}}),self.$("thumbnails").css({width:w,height:h}),carousel.max=w,carousel.hooks=hooks,carousel.width=self.$("thumbnails-list").width(),carousel.setClasses(),self.$("thumbnails-container").toggleClass("galleria-carousel",w>carousel.width),carousel.width=self.$("thumbnails-list").width()},bindControls:function(){var i;carousel.next.on("click:fast",function(e){if(e.preventDefault(),"auto"===self._options.carouselSteps){for(i=carousel.current;i<carousel.hooks.length;i++)if(carousel.hooks[i]-carousel.hooks[carousel.current]>carousel.width){carousel.set(i-2);break}}else carousel.set(carousel.current+self._options.carouselSteps)}),carousel.prev.on("click:fast",function(e){if(e.preventDefault(),"auto"===self._options.carouselSteps)for(i=carousel.current;i>=0;i--){if(carousel.hooks[carousel.current]-carousel.hooks[i]>carousel.width){carousel.set(i+2);break}if(0===i){carousel.set(0);break}}else carousel.set(carousel.current-self._options.carouselSteps)})},set:function(i){for(i=M.max(i,0);carousel.hooks[i-1]+carousel.width>=carousel.max&&i>=0;)i--;carousel.current=i,carousel.animate()},getLast:function(i){return(i||carousel.current)-1},follow:function(i){if(0===i||i===carousel.hooks.length-2)return void carousel.set(i);for(var last=carousel.current;carousel.hooks[last]-carousel.hooks[carousel.current]<carousel.width&&last<=carousel.hooks.length;)last++;i-1<carousel.current?carousel.set(i-1):i+2>last&&carousel.set(i-last+carousel.current+2)},setClasses:function(){carousel.prev.toggleClass("disabled",!carousel.current),carousel.next.toggleClass("disabled",carousel.hooks[carousel.current]+carousel.width>=carousel.max)},animate:function(to){carousel.setClasses();var num=-1*carousel.hooks[carousel.current];isNaN(num)||(self.$("thumbnails").css("left",function(){return $(this).css("left")}),Utils.animate(self.get("thumbnails"),{left:num},{duration:self._options.carouselSpeed,easing:self._options.easing,queue:!1}))}},tooltip=this._tooltip={initialized:!1,open:!1,timer:"tooltip"+self._id,swapTimer:"swap"+self._id,init:function(){tooltip.initialized=!0,Utils.insertStyleTag(".galleria-tooltip{padding:3px 8px;max-width:50%;background:#ffe;color:#000;z-index:3;position:absolute;font-size:11px;line-height:1.3;opacity:0;box-shadow:0 0 2px rgba(0,0,0,.4);-moz-box-shadow:0 0 2px rgba(0,0,0,.4);-webkit-box-shadow:0 0 2px rgba(0,0,0,.4);}","galleria-tooltip"),self.$("tooltip").css({opacity:.8,visibility:"visible",display:"none"})},move:function(e){var mouseX=self.getMousePosition(e).x,mouseY=self.getMousePosition(e).y,$elem=self.$("tooltip"),x=mouseX,y=mouseY,height=$elem.outerHeight(!0)+1,width=$elem.outerWidth(!0),limitY=height+15,maxX=self.$("container").width()-width-2,maxY=self.$("container").height()-height-2;isNaN(x)||isNaN(y)||(x+=10,y-=height+8,x=M.max(0,M.min(maxX,x)),y=M.max(0,M.min(maxY,y)),mouseY<limitY&&(y=limitY),$elem.css({left:x,top:y}))},bind:function(elem,value){if(!Galleria.TOUCH){tooltip.initialized||tooltip.init();var mouseout=function(){self.$("container").off("mousemove",tooltip.move),self.clearTimer(tooltip.timer),self.$("tooltip").stop().animate({opacity:0},200,function(){self.$("tooltip").hide(),self.addTimer(tooltip.swapTimer,function(){tooltip.open=!1},1e3)})},hover=function(elem,value){tooltip.define(elem,value),$(elem).hover(function(){self.clearTimer(tooltip.swapTimer),self.$("container").off("mousemove",tooltip.move).on("mousemove",tooltip.move).trigger("mousemove"),tooltip.show(elem),self.addTimer(tooltip.timer,function(){self.$("tooltip").stop().show().animate({opacity:1}),tooltip.open=!0},tooltip.open?0:500)},mouseout).click(mouseout)};"string"==typeof value?hover(elem in self._dom?self.get(elem):elem,value):$.each(elem,function(elemID,val){hover(self.get(elemID),val)})}},show:function(elem){elem=$(elem in self._dom?self.get(elem):elem);var text=elem.data("tt"),mouseup=function(e){window.setTimeout(function(ev){return function(){tooltip.move(ev)}}(e),10),elem.off("mouseup",mouseup)};(text="function"==typeof text?text():text)&&(self.$("tooltip").html(text.replace(/\s/,"&#160;")),elem.on("mouseup",mouseup))},define:function(elem,value){if("function"!=typeof value){var s=value;value=function(){return s}}elem=$(elem in self._dom?self.get(elem):elem).data("tt",value),tooltip.show(elem)}},fullscreen=this._fullscreen={scrolled:0,crop:undef,active:!1,prev:$(),beforeEnter:function(fn){fn()},beforeExit:function(fn){fn()},keymap:self._keyboard.map,parseCallback:function(callback,enter){return _transitions.active?function(){"function"==typeof callback&&callback.call(self);var active=self._controls.getActive(),next=self._controls.getNext();self._scaleImage(next),self._scaleImage(active),enter&&self._options.trueFullscreen&&$(active.container).add(next.container).trigger("transitionend")}:callback},enter:function(callback){fullscreen.beforeEnter(function(){callback=fullscreen.parseCallback(callback,!0),self._options.trueFullscreen&&_nativeFullscreen.support?(fullscreen.active=!0,Utils.forceStyles(self.get("container"),{width:"100%",height:"100%"}),self.rescale(),Galleria.MAC?Galleria.SAFARI&&/version\/[1-5]/.test(NAV)?(self.$("stage").css("opacity",0),window.setTimeout(function(){fullscreen.scale(),self.$("stage").css("opacity",1)},4)):(self.$("container").css("opacity",0).addClass("fullscreen"),window.setTimeout(function(){fullscreen.scale(),self.$("container").css("opacity",1)},50)):self.$("container").addClass("fullscreen"),$win.resize(fullscreen.scale),_nativeFullscreen.enter(self,callback,self.get("container"))):(fullscreen.scrolled=$win.scrollTop(),Galleria.TOUCH||window.scrollTo(0,0),fullscreen._enter(callback))})},_enter:function(callback){fullscreen.active=!0,IFRAME&&(fullscreen.iframe=function(){var elem,refer=doc.referrer,test=doc.createElement("a"),loc=window.location;return test.href=refer,test.protocol!=loc.protocol||test.hostname!=loc.hostname||test.port!=loc.port?(Galleria.raise("Parent fullscreen not available. Iframe protocol, domains and ports must match."),!1):(fullscreen.pd=window.parent.document,$(fullscreen.pd).find("iframe").each(function(){if((this.contentDocument||this.contentWindow.document)===doc)return elem=this,!1}),elem)}()),Utils.hide(self.getActiveImage()),IFRAME&&fullscreen.iframe&&(fullscreen.iframe.scrolled=$(window.parent).scrollTop(),window.parent.scrollTo(0,0));var data=self.getData(),options=self._options,inBrowser=!self._options.trueFullscreen||!_nativeFullscreen.support,htmlbody={height:"100%",overflow:"hidden",margin:0,padding:0};if(inBrowser&&(self.$("container").addClass("fullscreen"),fullscreen.prev=self.$("container").prev(),fullscreen.prev.length||(fullscreen.parent=self.$("container").parent()),self.$("container").appendTo("body"),Utils.forceStyles(self.get("container"),{position:Galleria.TOUCH?"absolute":"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:1e4}),Utils.forceStyles(DOM().html,htmlbody),Utils.forceStyles(DOM().body,htmlbody)),IFRAME&&fullscreen.iframe&&(Utils.forceStyles(fullscreen.pd.documentElement,htmlbody),Utils.forceStyles(fullscreen.pd.body,htmlbody),Utils.forceStyles(fullscreen.iframe,$.extend(htmlbody,{width:"100%",height:"100%",top:0,left:0,position:"fixed",zIndex:1e4,border:"none"}))),fullscreen.keymap=$.extend({},self._keyboard.map),self.attachKeyboard({escape:self.exitFullscreen,right:self.next,left:self.prev}),fullscreen.crop=options.imageCrop,options.fullscreenCrop!=undef&&(options.imageCrop=options.fullscreenCrop),data&&data.big&&data.image!==data.big){var big=new Galleria.Picture,cached=big.isCached(data.big),index=self.getIndex(),thumb=self._thumbnails[index];self.trigger({type:Galleria.LOADSTART,cached:cached,rewind:!1,index:index,imageTarget:self.getActiveImage(),thumbTarget:thumb,galleriaData:data}),big.load(data.big,function(big){self._scaleImage(big,{complete:function(big){self.trigger({type:Galleria.LOADFINISH,cached:cached,index:index,rewind:!1,imageTarget:big.image,thumbTarget:thumb});var image=self._controls.getActive().image;image&&$(image).width(big.image.width).height(big.image.height).attr("style",$(big.image).attr("style")).attr("src",big.image.src)}})});var n=self.getNext(index),p=new Galleria.Picture,ndata=self.getData(n);p.preload(self.isFullscreen()&&ndata.big?ndata.big:ndata.image)}self.rescale(function(){self.addTimer(!1,function(){inBrowser&&Utils.show(self.getActiveImage()),"function"==typeof callback&&callback.call(self),self.rescale()},100),self.trigger(Galleria.FULLSCREEN_ENTER)}),inBrowser?$win.resize(fullscreen.scale):Utils.show(self.getActiveImage())},scale:function(){self.rescale()},exit:function(callback){fullscreen.beforeExit(function(){callback=fullscreen.parseCallback(callback),self._options.trueFullscreen&&_nativeFullscreen.support?_nativeFullscreen.exit(callback):fullscreen._exit(callback)})},_exit:function(callback){fullscreen.active=!1;var inBrowser=!self._options.trueFullscreen||!_nativeFullscreen.support,$container=self.$("container").removeClass("fullscreen");if(fullscreen.parent?fullscreen.parent.prepend($container):$container.insertAfter(fullscreen.prev),inBrowser){Utils.hide(self.getActiveImage()),Utils.revertStyles(self.get("container"),DOM().html,DOM().body),Galleria.TOUCH||window.scrollTo(0,fullscreen.scrolled);var frame=self._controls.frames[self._controls.active];frame&&frame.image&&(frame.image.src=frame.image.src)}IFRAME&&fullscreen.iframe&&(Utils.revertStyles(fullscreen.pd.documentElement,fullscreen.pd.body,fullscreen.iframe),fullscreen.iframe.scrolled&&window.parent.scrollTo(0,fullscreen.iframe.scrolled)),self.detachKeyboard(),self.attachKeyboard(fullscreen.keymap),self._options.imageCrop=fullscreen.crop;var big=self.getData().big,image=self._controls.getActive().image;!self.getData().iframe&&image&&big&&big==image.src&&window.setTimeout(function(src){return function(){image.src=src}}(self.getData().image),1),self.rescale(function(){self.addTimer(!1,function(){inBrowser&&Utils.show(self.getActiveImage()),"function"==typeof callback&&callback.call(self),$win.trigger("resize")},50),self.trigger(Galleria.FULLSCREEN_EXIT)}),$win.off("resize",fullscreen.scale)}},idle=this._idle={trunk:[],bound:!1,active:!1,add:function(elem,to,from,hide){if(elem&&!Galleria.TOUCH){idle.bound||idle.addEvent(),elem=$(elem),"boolean"==typeof from&&(hide=from,from={}),from=from||{};var style,extract={};for(style in to)to.hasOwnProperty(style)&&(extract[style]=elem.css(style));elem.data("idle",{from:$.extend(extract,from),to:to,complete:!0,busy:!1}),hide?elem.css(to):idle.addTimer(),idle.trunk.push(elem)}},remove:function(elem){elem=$(elem),$.each(idle.trunk,function(i,el){el&&el.length&&!el.not(elem).length&&(elem.css(elem.data("idle").from),idle.trunk.splice(i,1))}),idle.trunk.length||(idle.removeEvent(),self.clearTimer(idle.timer))},addEvent:function(){idle.bound=!0,self.$("container").on("mousemove click",idle.showAll),"hover"==self._options.idleMode&&self.$("container").on("mouseleave",idle.hide)},removeEvent:function(){idle.bound=!1,self.$("container").on("mousemove click",idle.showAll),"hover"==self._options.idleMode&&self.$("container").off("mouseleave",idle.hide)},addTimer:function(){"hover"!=self._options.idleMode&&self.addTimer("idle",function(){idle.hide()},self._options.idleTime)},hide:function(){if(self._options.idleMode&&!1!==self.getIndex()){self.trigger(Galleria.IDLE_ENTER);var len=idle.trunk.length;$.each(idle.trunk,function(i,elem){var data=elem.data("idle");data&&(elem.data("idle").complete=!1,Utils.animate(elem,data.to,{duration:self._options.idleSpeed,complete:function(){i==len-1&&(idle.active=!1)}}))})}},showAll:function(){self.clearTimer("idle"),$.each(idle.trunk,function(i,elem){idle.show(elem)})},show:function(elem){var data=elem.data("idle");idle.active&&(data.busy||data.complete)||(data.busy=!0,self.trigger(Galleria.IDLE_EXIT),self.clearTimer("idle"),Utils.animate(elem,data.from,{duration:self._options.idleSpeed/2,complete:function(){idle.active=!0,$(elem).data("idle").busy=!1,$(elem).data("idle").complete=!0}})),idle.addTimer()}},lightbox=this._lightbox={width:0,height:0,initialized:!1,active:null,image:null,elems:{},keymap:!1,init:function(){if(!lightbox.initialized){lightbox.initialized=!0;var el={},op=self._options,css="",abs="position:absolute;",prefix="lightbox-",cssMap={overlay:"position:fixed;display:none;opacity:"+op.overlayOpacity+";filter:alpha(opacity="+100*op.overlayOpacity+");top:0;left:0;width:100%;height:100%;background:"+op.overlayBackground+";z-index:99990",box:"position:fixed;display:none;width:400px;height:400px;top:50%;left:50%;margin-top:-200px;margin-left:-200px;z-index:99991",shadow:abs+"background:#000;width:100%;height:100%;",content:abs+"background-color:#fff;top:10px;left:10px;right:10px;bottom:10px;overflow:hidden",info:abs+"bottom:10px;left:10px;right:10px;color:#444;font:11px/13px arial,sans-serif;height:13px",close:abs+"top:10px;right:10px;height:20px;width:20px;background:#fff;text-align:center;cursor:pointer;color:#444;font:16px/22px arial,sans-serif;z-index:99999",image:abs+"top:10px;left:10px;right:10px;bottom:30px;overflow:hidden;display:block;",prevholder:abs+"width:50%;top:0;bottom:40px;cursor:pointer;",nextholder:abs+"width:50%;top:0;bottom:40px;right:-1px;cursor:pointer;",prev:abs+"top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;left:20px;display:none;text-align:center;color:#000;font:bold 16px/36px arial,sans-serif",next:abs+"top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;right:20px;left:auto;display:none;font:bold 16px/36px arial,sans-serif;text-align:center;color:#000",title:"float:left",counter:"float:right;margin-left:8px;"},hover=function(elem){return elem.hover(function(){$(this).css("color","#bbb")},function(){$(this).css("color","#444")})},appends={},exs="";exs=IE>7?IE<9?"background:#000;filter:alpha(opacity=0);":"background:rgba(0,0,0,0);":"z-index:99999",cssMap.nextholder+=exs,cssMap.prevholder+=exs,$.each(cssMap,function(key,value){css+=".galleria-"+prefix+key+"{"+value+"}"}),css+=".galleria-"+prefix+"box.iframe .galleria-"+prefix+"prevholder,.galleria-"+prefix+"box.iframe .galleria-"+prefix+"nextholder{width:100px;height:100px;top:50%;margin-top:-70px}",Utils.insertStyleTag(css,"galleria-lightbox"),$.each("overlay box content shadow title info close prevholder prev nextholder next counter image".split(" "),function(i,elemId){self.addElement("lightbox-"+elemId),el[elemId]=lightbox.elems[elemId]=self.get("lightbox-"+elemId)}),lightbox.image=new Galleria.Picture,$.each({box:"shadow content close prevholder nextholder",info:"title counter",content:"info image",prevholder:"prev",nextholder:"next"},function(key,val){var arr=[];$.each(val.split(" "),function(i,prop){arr.push(prefix+prop)}),appends[prefix+key]=arr}),self.append(appends),$(el.image).append(lightbox.image.container),$(DOM().body).append(el.overlay,el.box),hover($(el.close).on("click:fast",lightbox.hide).html("&#215;")),$.each(["Prev","Next"],function(i,dir){var $d=$(el[dir.toLowerCase()]).html(/v/.test(dir)?"&#8249;&#160;":"&#160;&#8250;"),$e=$(el[dir.toLowerCase()+"holder"]);if($e.on("click:fast",function(){lightbox["show"+dir]()}),IE<8||Galleria.TOUCH)return void $d.show();$e.hover(function(){$d.show()},function(e){$d.stop().fadeOut(200)})}),$(el.overlay).on("click:fast",lightbox.hide),Galleria.IPAD&&(self._options.lightboxTransitionSpeed=0)}},rescale:function(event){var width=M.min($win.width()-40,lightbox.width),height=M.min($win.height()-60,lightbox.height),ratio=M.min(width/lightbox.width,height/lightbox.height),destWidth=M.round(lightbox.width*ratio)+40,destHeight=M.round(lightbox.height*ratio)+60,to={width:destWidth,height:destHeight,"margin-top":-1*M.ceil(destHeight/2),"margin-left":-1*M.ceil(destWidth/2)};event?$(lightbox.elems.box).css(to):$(lightbox.elems.box).animate(to,{duration:self._options.lightboxTransitionSpeed,easing:self._options.easing,complete:function(){var image=lightbox.image,speed=self._options.lightboxFadeSpeed;self.trigger({type:Galleria.LIGHTBOX_IMAGE,imageTarget:image.image}),$(image.container).show(),$(image.image).animate({opacity:1},speed),Utils.show(lightbox.elems.info,speed)}})},hide:function(){lightbox.image.image=null,$win.off("resize",lightbox.rescale),$(lightbox.elems.box).hide().find("iframe").remove(),Utils.hide(lightbox.elems.info),self.detachKeyboard(),self.attachKeyboard(lightbox.keymap),lightbox.keymap=!1,Utils.hide(lightbox.elems.overlay,200,function(){$(this).hide().css("opacity",self._options.overlayOpacity),self.trigger(Galleria.LIGHTBOX_CLOSE)})},showNext:function(){lightbox.show(self.getNext(lightbox.active))},showPrev:function(){lightbox.show(self.getPrev(lightbox.active))},show:function(index){lightbox.active=index="number"==typeof index?index:self.getIndex()||0,lightbox.initialized||lightbox.init(),self.trigger(Galleria.LIGHTBOX_OPEN),lightbox.keymap||(lightbox.keymap=$.extend({},self._keyboard.map),self.attachKeyboard({escape:lightbox.hide,right:lightbox.showNext,left:lightbox.showPrev})),$win.off("resize",lightbox.rescale);var ndata,p,i,data=self.getData(index),total=self.getDataLength(),n=self.getNext(index);Utils.hide(lightbox.elems.info);try{for(i=self._options.preload;i>0;i--)p=new Galleria.Picture,ndata=self.getData(n),p.preload(ndata.big?ndata.big:ndata.image),n=self.getNext(n)}catch(e){}lightbox.image.isIframe=data.iframe&&!data.image,$(lightbox.elems.box).toggleClass("iframe",lightbox.image.isIframe),$(lightbox.image.container).find(".galleria-videoicon").remove(),lightbox.image.load(data.big||data.image||data.iframe,function(image){if(image.isIframe){var cw=$(window).width(),ch=$(window).height();if(image.video&&self._options.maxVideoSize){var r=M.min(self._options.maxVideoSize/cw,self._options.maxVideoSize/ch);r<1&&(cw*=r,ch*=r)}lightbox.width=cw,lightbox.height=ch}else lightbox.width=image.original.width,lightbox.height=image.original.height;if($(image.image).css({width:image.isIframe?"100%":"100.1%",height:image.isIframe?"100%":"100.1%",top:0,bottom:0,zIndex:99998,opacity:0,visibility:"visible"}).parent().height("100%"),lightbox.elems.title.innerHTML=data.title||"",lightbox.elems.counter.innerHTML=index+1+" / "+total,$win.resize(lightbox.rescale),lightbox.rescale(),data.image&&data.iframe){if($(lightbox.elems.box).addClass("iframe"),data.video){var $icon=_playIcon(image.container).hide();window.setTimeout(function(){$icon.fadeIn(200)},200)}$(image.image).css("cursor","pointer").mouseup(function(data,image){return function(e){$(lightbox.image.container).find(".galleria-videoicon").remove(),e.preventDefault(),image.isIframe=!0,image.load(data.iframe+(data.video?"&autoplay=1":""),{width:"100%",height:IE<8?$(lightbox.image.container).height():"100%"})}}(data,image))}}),$(lightbox.elems.overlay).show().css("visibility","visible"),$(lightbox.elems.box).show()}},_timer=this._timer={trunk:{},add:function(id,fn,delay,loop){if(id=id||(new Date).getTime(),loop=loop||!1,this.clear(id),loop){var old=fn;fn=function(){old(),_timer.add(id,fn,delay)}}this.trunk[id]=window.setTimeout(fn,delay)},clear:function(id){var i,del=function(i){window.clearTimeout(this.trunk[i]),delete this.trunk[i]};if(id&&id in this.trunk)del.call(this,id);else if(void 0===id)for(i in this.trunk)this.trunk.hasOwnProperty(i)&&del.call(this,i)}};return this},Galleria.prototype={constructor:Galleria,init:function(target,options){if(options=_legacyOptions(options),this._original={target:target,options:options,data:null},this._target=this._dom.target=target.nodeName?target:$(target).get(0),this._original.html=this._target.innerHTML,_instances.push(this),!this._target)return void Galleria.raise("Target not found",!0);if(this._options={autoplay:!1,carousel:!0,carouselFollow:!0,carouselSpeed:400,carouselSteps:"auto",clicknext:!1,dailymotion:{foreground:"%23EEEEEE",highlight:"%235BCEC5",background:"%23222222",logo:0,hideInfos:1},dataConfig:function(elem){return{}},dataSelector:"img",dataSort:!1,dataSource:this._target,debug:undef,dummy:undef,easing:"galleria",extend:function(options){},fullscreenCrop:undef,fullscreenDoubleTap:!0,fullscreenTransition:undef,height:0,idleMode:!0,idleTime:3e3,idleSpeed:200,imageCrop:!1,imageMargin:0,imagePan:!1,imagePanSmoothness:12,imagePosition:"50%",imageTimeout:undef,initialTransition:undef,keepSource:!1,layerFollow:!0,lightbox:!1,lightboxFadeSpeed:200,lightboxTransitionSpeed:200,linkSourceImages:!0,maxScaleRatio:undef,maxVideoSize:undef,minScaleRatio:undef,overlayOpacity:.85,overlayBackground:"#0b0b0b",pauseOnInteraction:!0,popupLinks:!1,preload:2,queue:!0,responsive:!0,show:0,showInfo:!0,showCounter:!0,showImagenav:!0,swipe:"auto",theme:null,thumbCrop:!0,thumbEventType:"click:fast",thumbMargin:0,thumbQuality:"auto",thumbDisplayOrder:!0,thumbPosition:"50%",thumbnails:!0,touchTransition:undef,transition:"fade",transitionInitial:undef,transitionSpeed:400,trueFullscreen:!0,useCanvas:!1,variation:"",videoPoster:!0,vimeo:{title:0,byline:0,portrait:0,color:"aaaaaa"},wait:5e3,width:"auto",youtube:{modestbranding:1,autohide:1,color:"white",hd:1,rel:0,showinfo:0}},this._options.initialTransition=this._options.initialTransition||this._options.transitionInitial,options&&(!1===options.debug&&(DEBUG=!1),"number"==typeof options.imageTimeout&&(TIMEOUT=options.imageTimeout),"string"==typeof options.dummy&&(DUMMY=options.dummy),"string"==typeof options.theme&&(this._options.theme=options.theme)),$(this._target).children().hide(),Galleria.QUIRK&&Galleria.raise("Your page is in Quirks mode, Galleria may not render correctly. Please validate your HTML and add a correct doctype."),_loadedThemes.length)if(this._options.theme){for(var i=0;i<_loadedThemes.length;i++)if(this._options.theme===_loadedThemes[i].name){this.theme=_loadedThemes[i];break}}else this.theme=_loadedThemes[0];return"object"==typeof this.theme?this._init():_pool.push(this),this},_init:function(){var self=this,options=this._options;if(this._initialized)return Galleria.raise("Init failed: Gallery instance already initialized."),this;if(this._initialized=!0,!this.theme)return Galleria.raise("Init failed: No theme found.",!0),this;if($.extend(!0,options,this.theme.defaults,this._original.options,Galleria.configure.options),options.swipe=function(s){return"enforced"==s||!1!==s&&"disabled"!=s&&!!Galleria.TOUCH}(options.swipe),options.swipe&&(options.clicknext=!1,options.imagePan=!1),function(can){if(!("getContext"in can))return void(can=null);_canvas=_canvas||{elem:can,context:can.getContext("2d"),cache:{},length:0}}(doc.createElement("canvas")),this.bind(Galleria.DATA,function(){window.screen&&window.screen.width&&Array.prototype.forEach&&this._data.forEach(function(data){var density="devicePixelRatio"in window?window.devicePixelRatio:1;M.max(window.screen.width,window.screen.height)*density<1024&&(data.big=data.image)}),this._original.data=this._data,this.get("total").innerHTML=this.getDataLength();var $container=this.$("container");self._options.height<2&&(self._userRatio=self._ratio=self._options.height);var num={width:0,height:0},testHeight=function(){return self.$("stage").height()};Utils.wait({until:function(){return num=self._getWH(),$container.width(num.width).height(num.height),testHeight()&&num.width&&num.height>50},success:function(){self._width=num.width,self._height=num.height,self._ratio=self._ratio||num.height/num.width,Galleria.WEBKIT?window.setTimeout(function(){self._run()},1):self._run()},error:function(){testHeight()?Galleria.raise("Could not extract sufficient width/height of the gallery container. Traced measures: width:"+num.width+"px, height: "+num.height+"px.",!0):Galleria.raise("Could not extract a stage height from the CSS. Traced height: "+testHeight()+"px.",!0)},timeout:"number"==typeof this._options.wait&&this._options.wait})}),this.append({"info-text":["info-title","info-description"],info:["info-text"],"image-nav":["image-nav-right","image-nav-left"],stage:["images","loader","counter","image-nav"],"thumbnails-list":["thumbnails"],"thumbnails-container":["thumb-nav-left","thumbnails-list","thumb-nav-right"],container:["stage","thumbnails-container","info","tooltip"]}),Utils.hide(this.$("counter").append(this.get("current"),doc.createTextNode(" / "),this.get("total"))),this.setCounter("&#8211;"),Utils.hide(self.get("tooltip")),this.$("container").addClass([Galleria.TOUCH?"touch":"notouch",this._options.variation,"galleria-theme-"+this.theme.name].join(" ")),this._options.swipe||$.each(new Array(2),function(i){var image=new Galleria.Picture;$(image.container).css({position:"absolute",top:0,left:0}).prepend(self._layers[i]=$(Utils.create("galleria-layer")).css({position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:2})[0]),self.$("images").append(image.container),self._controls[i]=image;var frame=new Galleria.Picture;frame.isIframe=!0,$(frame.container).attr("class","galleria-frame").css({position:"absolute",top:0,left:0,zIndex:4,background:"#000",display:"none"}).appendTo(image.container),self._controls.frames[i]=frame}),this.$("images").css({position:"relative",top:0,left:0,width:"100%",height:"100%"}),options.swipe&&(this.$("images").css({position:"absolute",top:0,left:0,width:0,height:"100%"}),this.finger=new Galleria.Finger(this.get("stage"),{onchange:function(page){self.pause().show(page)},oncomplete:function(page){var index=M.max(0,M.min(parseInt(page,10),self.getDataLength()-1)),data=self.getData(index);$(self._thumbnails[index].container).addClass("active").siblings(".active").removeClass("active"),data&&(self.$("images").find(".galleria-frame").css("opacity",0).hide().find("iframe").remove(),self._options.carousel&&self._options.carouselFollow&&self._carousel.follow(index))}}),this.bind(Galleria.RESCALE,function(){this.finger.setup()}),this.$("stage").on("click",function(e){var data=self.getData();if(data){if(data.iframe){self.isPlaying()&&self.pause();var frame=self._controls.frames[self._active],w=self._stageWidth,h=self._stageHeight;if($(frame.container).find("iframe").length)return;return $(frame.container).css({width:w,height:h,opacity:0}).show().animate({opacity:1},200),void window.setTimeout(function(){frame.load(data.iframe+(data.video?"&autoplay=1":""),{width:w,height:h},function(frame){self.$("container").addClass("videoplay"),frame.scale({width:self._stageWidth,height:self._stageHeight,iframelimit:data.video?self._options.maxVideoSize:undef})})},100)}data.link&&(self._options.popupLinks?window.open(data.link,"_blank"):window.location.href=data.link)}}),this.bind(Galleria.IMAGE,function(e){self.setCounter(e.index),self.setInfo(e.index);var next=this.getNext(),prev=this.getPrev(),preloads=[prev,next];preloads.push(this.getNext(next),this.getPrev(prev),self._controls.slides.length-1);var filtered=[];$.each(preloads,function(i,val){-1==$.inArray(val,filtered)&&filtered.push(val)}),$.each(filtered,function(i,loadme){var d=self.getData(loadme),img=self._controls.slides[loadme],src=self.isFullscreen()&&d.big?d.big:d.image||d.iframe;d.iframe&&!d.image&&(img.isIframe=!0),img.ready||self._controls.slides[loadme].load(src,function(img){img.isIframe||$(img.image).css("visibility","hidden"),self._scaleImage(img,{complete:function(img){img.isIframe||$(img.image).css({opacity:0,visibility:"visible"}).animate({opacity:1},200)}})})})})),this.$("thumbnails, thumbnails-list").css({overflow:"hidden",position:"relative"}),this.$("image-nav-right, image-nav-left").on("click:fast",function(e){options.pauseOnInteraction&&self.pause();var fn=/right/.test(this.className)?"next":"prev";self[fn]()}).on("click",function(e){e.preventDefault(),(options.clicknext||options.swipe)&&e.stopPropagation()}),$.each(["info","counter","image-nav"],function(i,el){!1===options["show"+el.substr(0,1).toUpperCase()+el.substr(1).replace(/-/,"")]&&Utils.moveOut(self.get(el.toLowerCase()))}),this.load(),options.keepSource||IE||(this._target.innerHTML=""),this.get("errors")&&this.appendChild("target","errors"),this.appendChild("target","container"),options.carousel){var count=0,show=options.show;this.bind(Galleria.THUMBNAIL,function(){this.updateCarousel(),++count==this.getDataLength()&&"number"==typeof show&&show>0&&this._carousel.follow(show)})}return options.responsive&&$win.on("resize",function(){self.isFullscreen()||self.resize()}),options.fullscreenDoubleTap&&this.$("stage").on("touchstart",function(){var last,cx,cy,lx,ly,now,getData=function(e){return e.originalEvent.touches?e.originalEvent.touches[0]:e};return self.$("stage").on("touchmove",function(){last=0}),function(e){if(!/(-left|-right)/.test(e.target.className)){if(now=Utils.timestamp(),cx=getData(e).pageX,cy=getData(e).pageY,e.originalEvent.touches.length<2&&now-last<300&&cx-lx<20&&cy-ly<20)return self.toggleFullscreen(),void e.preventDefault();last=now,lx=cx,ly=cy}}}()),$.each(Galleria.on.binds,function(i,bind){-1==$.inArray(bind.hash,self._binds)&&self.bind(bind.type,bind.callback)}),this},addTimer:function(){return this._timer.add.apply(this._timer,Utils.array(arguments)),this},clearTimer:function(){return this._timer.clear.apply(this._timer,Utils.array(arguments)),this},_getWH:function(){var arr,$container=this.$("container"),$target=this.$("target"),self=this,num={};return $.each(["width","height"],function(i,m){self._options[m]&&"number"==typeof self._options[m]?num[m]=self._options[m]:(arr=[Utils.parseValue($container.css(m)),Utils.parseValue($target.css(m)),$container[m](),$target[m]()],self["_"+m]||arr.splice(arr.length,Utils.parseValue($container.css("min-"+m)),Utils.parseValue($target.css("min-"+m))),num[m]=M.max.apply(M,arr))}),self._userRatio&&(num.height=num.width*self._userRatio),num},_createThumbnails:function(push){this.get("total").innerHTML=this.getDataLength();var src,thumb,data,$container,self=this,o=this._options,i=push?this._data.length-push.length:0,chunk=i,thumbchunk=[],loadindex=0,gif=IE<8?"http://upload.wikimedia.org/wikipedia/commons/c/c0/Blank.gif":"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw%3D%3D",active=function(){var a=self.$("thumbnails").find(".active");return!!a.length&&a.find("img").attr("src")}(),optval="string"==typeof o.thumbnails?o.thumbnails.toLowerCase():null,getStyle=function(prop){return doc.defaultView&&doc.defaultView.getComputedStyle?doc.defaultView.getComputedStyle(thumb.container,null)[prop]:$container.css(prop)},fake=function(image,index,container){return function(){$(container).append(image),self.trigger({type:Galleria.THUMBNAIL,thumbTarget:image,index:index,galleriaData:self.getData(index)})}},onThumbEvent=function(e){o.pauseOnInteraction&&self.pause();var index=$(e.currentTarget).data("index");self.getIndex()!==index&&self.show(index),e.preventDefault()},thumbComplete=function(thumb,callback){$(thumb.container).css("visibility","visible"),self.trigger({type:Galleria.THUMBNAIL,thumbTarget:thumb.image,index:thumb.data.order,galleriaData:self.getData(thumb.data.order)}),"function"==typeof callback&&callback.call(self,thumb)},onThumbLoad=function(thumb,callback){thumb.scale({width:thumb.data.width,height:thumb.data.height,crop:o.thumbCrop,margin:o.thumbMargin,canvas:o.useCanvas,position:o.thumbPosition,complete:function(thumb){var m,css,top=["left","top"],arr=["Width","Height"];self.getData(thumb.index),$.each(arr,function(i,measure){m=measure.toLowerCase(),!0===o.thumbCrop&&o.thumbCrop!==m||(css={},css[m]=thumb[m],$(thumb.container).css(css),css={},css[top[i]]=0,$(thumb.image).css(css)),thumb["outer"+measure]=$(thumb.container)["outer"+measure](!0)}),Utils.toggleQuality(thumb.image,!0===o.thumbQuality||"auto"===o.thumbQuality&&thumb.original.width<3*thumb.width),o.thumbDisplayOrder&&!thumb.lazy?$.each(thumbchunk,function(i,th){if(i===loadindex&&th.ready&&!th.displayed)return loadindex++,th.displayed=!0,void thumbComplete(th,callback)}):thumbComplete(thumb,callback)}})};for(push||(this._thumbnails=[],this.$("thumbnails").empty());this._data[i];i++)data=this._data[i],src=data.thumb||data.image,!0!==o.thumbnails&&"lazy"!=optval||!data.thumb&&!data.image?data.iframe&&null!==optval||"empty"===optval||"numbers"===optval?(thumb={container:Utils.create("galleria-image"),image:Utils.create("img","span"),ready:!0,data:{order:i}},"numbers"===optval&&$(thumb.image).text(i+1),data.iframe&&$(thumb.image).addClass("iframe"),this.$("thumbnails").append(thumb.container),window.setTimeout(fake(thumb.image,i,thumb.container),50+20*i)):thumb={container:null,image:null}:(thumb=new Galleria.Picture(i),thumb.index=i,thumb.displayed=!1,thumb.lazy=!1,thumb.video=!1,this.$("thumbnails").append(thumb.container),$container=$(thumb.container),$container.css("visibility","hidden"),thumb.data={width:Utils.parseValue(getStyle("width")),height:Utils.parseValue(getStyle("height")),order:i,src:src},!0!==o.thumbCrop?$container.css({width:"auto",height:"auto"}):$container.css({width:thumb.data.width,height:thumb.data.height}),"lazy"==optval?($container.addClass("lazy"),thumb.lazy=!0,thumb.load(gif,{height:thumb.data.height,width:thumb.data.width})):thumb.load(src,onThumbLoad),"all"===o.preload&&thumb.preload(data.image)),$(thumb.container).add(o.keepSource&&o.linkSourceImages?data.original:null).data("index",i).on(o.thumbEventType,onThumbEvent).data("thumbload",onThumbLoad),active===src&&$(thumb.container).addClass("active"),this._thumbnails.push(thumb);return thumbchunk=this._thumbnails.slice(chunk),this},lazyLoad:function(index,complete){var arr=index.constructor==Array?index:[index],self=this,loaded=0;return $.each(arr,function(i,ind){if(!(ind>self._thumbnails.length-1)){var thumb=self._thumbnails[ind],data=thumb.data,callback=function(){++loaded==arr.length&&"function"==typeof complete&&complete.call(self)},thumbload=$(thumb.container).data("thumbload");thumb.video?thumbload.call(self,thumb,callback):thumb.load(data.src,function(thumb){thumbload.call(self,thumb,callback)})}}),this},lazyLoadChunks:function(size,delay){var len=this.getDataLength(),i=0,n=0,arr=[],temp=[],self=this;for(delay=delay||0;i<len;i++)temp.push(i),++n!=size&&i!=len-1||(arr.push(temp),n=0,temp=[]);var init=function(wait){var a=arr.shift();a&&window.setTimeout(function(){self.lazyLoad(a,function(){init(!0)})},delay&&wait?delay:0)};return init(!1),this},_run:function(){var self=this;self._createThumbnails(),Utils.wait({timeout:1e4,until:function(){return Galleria.OPERA&&self.$("stage").css("display","inline-block"),self._stageWidth=self.$("stage").width(),self._stageHeight=self.$("stage").height(),self._stageWidth&&self._stageHeight>50},success:function(){if(_galleries.push(self),self._options.swipe){var $images=self.$("images").width(self.getDataLength()*self._stageWidth);$.each(new Array(self.getDataLength()),function(i){var image=new Galleria.Picture,data=self.getData(i);$(image.container).css({position:"absolute",top:0,left:self._stageWidth*i}).prepend(self._layers[i]=$(Utils.create("galleria-layer")).css({position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:2})[0]).appendTo($images),data.video&&_playIcon(image.container),self._controls.slides.push(image);var frame=new Galleria.Picture;frame.isIframe=!0,$(frame.container).attr("class","galleria-frame").css({position:"absolute",top:0,left:0,zIndex:4,background:"#000",display:"none"}).appendTo(image.container),self._controls.frames.push(frame)}),self.finger.setup()}if(Utils.show(self.get("counter")),self._options.carousel&&self._carousel.bindControls(),self._options.autoplay&&(self.pause(),"number"==typeof self._options.autoplay&&(self._playtime=self._options.autoplay),self._playing=!0),self._firstrun)return self._options.autoplay&&self.trigger(Galleria.PLAY),void("number"==typeof self._options.show&&self.show(self._options.show));self._firstrun=!0,Galleria.History&&Galleria.History.change(function(value){isNaN(value)?window.history.go(-1):self.show(value,undef,!0)}),self.trigger(Galleria.READY),self.theme.init.call(self,self._options),$.each(Galleria.ready.callbacks,function(i,fn){"function"==typeof fn&&fn.call(self,self._options)}),self._options.extend.call(self,self._options),/^[0-9]{1,4}$/.test(HASH)&&Galleria.History?self.show(HASH,undef,!0):self._data[self._options.show]&&self.show(self._options.show),self._options.autoplay&&self.trigger(Galleria.PLAY)},error:function(){Galleria.raise("Stage width or height is too small to show the gallery. Traced measures: width:"+self._stageWidth+"px, height: "+self._stageHeight+"px.",!0)}})},load:function(source,selector,config){var self=this,o=this._options;return this._data=[],this._thumbnails=[],this.$("thumbnails").empty(),"function"==typeof selector&&(config=selector,selector=null),source=source||o.dataSource,selector=selector||o.dataSelector,config=config||o.dataConfig,$.isPlainObject(source)&&(source=[source]),$.isArray(source)?this.validate(source)?this._data=source:Galleria.raise("Load failed: JSON Array not valid."):(selector+=",.video,.iframe",$(source).find(selector).each(function(i,elem){elem=$(elem);var data={},parent=elem.parent(),href=parent.attr("href"),rel=parent.attr("rel");href&&("IMG"==elem[0].nodeName||elem.hasClass("video"))&&_videoTest(href)?data.video=href:href&&elem.hasClass("iframe")?data.iframe=href:data.image=data.big=href,rel&&(data.big=rel),$.each("big title description link layer image".split(" "),function(i,val){elem.data(val)&&(data[val]=elem.data(val).toString())}),data.big||(data.big=data.image),self._data.push($.extend({title:elem.attr("title")||"",thumb:elem.attr("src"),image:elem.attr("src"),big:elem.attr("src"),description:elem.attr("alt")||"",link:elem.attr("longdesc"),original:elem.get(0)},data,config(elem)))})),"function"==typeof o.dataSort?protoArray.sort.call(this._data,o.dataSort):"random"==o.dataSort&&this._data.sort(function(){return M.round(M.random())-.5}),this.getDataLength()&&this._parseData(function(){this.trigger(Galleria.DATA)}),this},_parseData:function(callback){var current,self=this,ready=!1,onload=function(){var complete=!0;$.each(self._data,function(i,data){if(data.loading)return complete=!1,!1}),complete&&!ready&&(ready=!0,callback.call(self))};return $.each(this._data,function(i,data){if(current=self._data[i],"thumb"in data==0&&(current.thumb=data.image),data.big||(current.big=data.image),"video"in data){var result=_videoTest(data.video);result&&(current.iframe=new Video(result.provider,result.id).embed()+function(){if("object"==typeof self._options[result.provider]){var arr=[];return $.each(self._options[result.provider],function(key,val){arr.push(key+"="+val)}),"youtube"==result.provider&&(arr=["wmode=opaque"].concat(arr)),"?"+arr.join("&")}return""}(),current.thumb&&current.image||$.each(["thumb","image"],function(i,type){if("image"==type&&!self._options.videoPoster)return void(current.image=undef);var video=new Video(result.provider,result.id);current[type]||(current.loading=!0,video.getMedia(type,function(current,type){return function(src){current[type]=src,"image"!=type||current.big||(current.big=current.image),delete current.loading,onload()}}(current,type)))}))}}),onload(),this},destroy:function(){return this.$("target").data("galleria",null),this.$("container").off("galleria"),this.get("target").innerHTML=this._original.html,this.clearTimer(),Utils.removeFromArray(_instances,this),Utils.removeFromArray(_galleries,this),Galleria._waiters.length&&$.each(Galleria._waiters,function(i,w){w&&window.clearTimeout(w)}),this},splice:function(){var self=this,args=Utils.array(arguments);return window.setTimeout(function(){protoArray.splice.apply(self._data,args),self._parseData(function(){self._createThumbnails()})},2),self},push:function(){var self=this,args=Utils.array(arguments);return 1==args.length&&args[0].constructor==Array&&(args=args[0]),window.setTimeout(function(){protoArray.push.apply(self._data,args),self._parseData(function(){self._createThumbnails(args)})},2),self},_getActive:function(){return this._controls.getActive()},validate:function(data){return!0},bind:function(type,fn){return type=_patchEvent(type),this.$("container").on(type,this.proxy(fn)),this},unbind:function(type){return type=_patchEvent(type),this.$("container").off(type),this},trigger:function(type){return type="object"==typeof type?$.extend(type,{scope:this}):{type:_patchEvent(type),scope:this},this.$("container").trigger(type),this},addIdleState:function(elem,styles,from,hide){return this._idle.add.apply(this._idle,Utils.array(arguments)),this},removeIdleState:function(elem){return this._idle.remove.apply(this._idle,Utils.array(arguments)),this},enterIdleMode:function(){return this._idle.hide(),this},exitIdleMode:function(){return this._idle.showAll(),this},enterFullscreen:function(callback){return this._fullscreen.enter.apply(this,Utils.array(arguments)),this},exitFullscreen:function(callback){return this._fullscreen.exit.apply(this,Utils.array(arguments)),this},toggleFullscreen:function(callback){return this._fullscreen[this.isFullscreen()?"exit":"enter"].apply(this,Utils.array(arguments)),this},bindTooltip:function(elem,value){return this._tooltip.bind.apply(this._tooltip,Utils.array(arguments)),this},defineTooltip:function(elem,value){return this._tooltip.define.apply(this._tooltip,Utils.array(arguments)),this},refreshTooltip:function(elem){return this._tooltip.show.apply(this._tooltip,Utils.array(arguments)),this},openLightbox:function(){return this._lightbox.show.apply(this._lightbox,Utils.array(arguments)),this},closeLightbox:function(){return this._lightbox.hide.apply(this._lightbox,Utils.array(arguments)),this},hasVariation:function(variation){return $.inArray(variation,this._options.variation.split(/\s+/))>-1},getActiveImage:function(){var active=this._getActive();return active?active.image:undef},getActiveThumb:function(){return this._thumbnails[this._active].image||undef},getMousePosition:function(e){return{x:e.pageX-this.$("container").offset().left,y:e.pageY-this.$("container").offset().top}},addPan:function(img){if(!1!==this._options.imageCrop){img=$(img||this.getActiveImage());var self=this,x=img.width()/2,y=img.height()/2,destX=parseInt(img.css("left"),10),destY=parseInt(img.css("top"),10),curX=destX||0,curY=destY||0,distX=0,distY=0,active=!1,ts=Utils.timestamp(),cache=0,move=0,position=function(dist,cur,pos){if(dist>0&&(move=M.round(M.max(-1*dist,M.min(0,cur))),cache!==move))if(cache=move,8===IE)img.parent()["scroll"+pos](-1*move);else{var css={};css[pos.toLowerCase()]=move,img.css(css)}},calculate=function(e){Utils.timestamp()-ts<50||(active=!0,x=self.getMousePosition(e).x,y=self.getMousePosition(e).y)},loop=function(e){active&&(distX=img.width()-self._stageWidth,distY=img.height()-self._stageHeight,destX=x/self._stageWidth*distX*-1,destY=y/self._stageHeight*distY*-1,curX+=(destX-curX)/self._options.imagePanSmoothness,curY+=(destY-curY)/self._options.imagePanSmoothness,position(distY,curY,"Top"),position(distX,curX,"Left"))};return 8===IE&&(img.parent().scrollTop(-1*curY).scrollLeft(-1*curX),img.css({top:0,left:0})),this.$("stage").off("mousemove",calculate).on("mousemove",calculate),this.addTimer("pan"+self._id,loop,50,!0),this}},proxy:function(fn,scope){return"function"!=typeof fn?F:(scope=scope||this,function(){return fn.apply(scope,Utils.array(arguments))})},getThemeName:function(){return this.theme.name},removePan:function(){return this.$("stage").off("mousemove"),this.clearTimer("pan"+this._id),this},addElement:function(id){var dom=this._dom;return $.each(Utils.array(arguments),function(i,blueprint){dom[blueprint]=Utils.create("galleria-"+blueprint)}),this},attachKeyboard:function(map){return this._keyboard.attach.apply(this._keyboard,Utils.array(arguments)),this},detachKeyboard:function(){return this._keyboard.detach.apply(this._keyboard,Utils.array(arguments)),this},appendChild:function(parentID,childID){return this.$(parentID).append(this.get(childID)||childID),this},prependChild:function(parentID,childID){return this.$(parentID).prepend(this.get(childID)||childID),this},remove:function(elemID){return this.$(Utils.array(arguments).join(",")).remove(),this},append:function(data){var i,j;for(i in data)if(data.hasOwnProperty(i))if(data[i].constructor===Array)for(j=0;data[i][j];j++)this.appendChild(i,data[i][j]);else this.appendChild(i,data[i]);return this},_scaleImage:function(image,options){if(image=image||this._controls.getActive()){var complete,scaleLayer=function(img){$(img.container).children(":first").css({top:M.max(0,Utils.parseValue(img.image.style.top)),left:M.max(0,Utils.parseValue(img.image.style.left)),width:Utils.parseValue(img.image.width),height:Utils.parseValue(img.image.height)})};return options=$.extend({width:this._stageWidth,height:this._stageHeight,crop:this._options.imageCrop,max:this._options.maxScaleRatio,min:this._options.minScaleRatio,margin:this._options.imageMargin,position:this._options.imagePosition,iframelimit:this._options.maxVideoSize},options),this._options.layerFollow&&!0!==this._options.imageCrop?"function"==typeof options.complete?(complete=options.complete,options.complete=function(){complete.call(image,image),scaleLayer(image)}):options.complete=scaleLayer:$(image.container).children(":first").css({top:0,left:0}),image.scale(options),this}},updateCarousel:function(){return this._carousel.update(),this},resize:function(measures,complete){"function"==typeof measures&&(complete=measures,measures=undef),measures=$.extend({width:0,height:0},measures);var self=this,$container=this.$("container");return $.each(measures,function(m,val){val||($container[m]("auto"),measures[m]=self._getWH()[m])}),$.each(measures,function(m,val){$container[m](val)}),this.rescale(complete)},rescale:function(width,height,complete){var self=this;return"function"==typeof width&&(complete=width,width=undef),function(){self._stageWidth=width||self.$("stage").width(),self._stageHeight=height||self.$("stage").height(),self._options.swipe?($.each(self._controls.slides,function(i,img){self._scaleImage(img),$(img.container).css("left",self._stageWidth*i)}),self.$("images").css("width",self._stageWidth*self.getDataLength())):self._scaleImage(),self._options.carousel&&self.updateCarousel(),self._controls.frames[self._controls.active]&&self._controls.frames[self._controls.active].scale({width:self._stageWidth,height:self._stageHeight,iframelimit:self._options.maxVideoSize}),self.trigger(Galleria.RESCALE),"function"==typeof complete&&complete.call(self)}.call(self),this},refreshImage:function(){return this._scaleImage(),this._options.imagePan&&this.addPan(),this},_preload:function(){if(this._options.preload){var p,i,ndata,n=this.getNext();try{for(i=this._options.preload;i>0;i--)p=new Galleria.Picture,ndata=this.getData(n),p.preload(this.isFullscreen()&&ndata.big?ndata.big:ndata.image),n=this.getNext(n)}catch(e){}}},show:function(index,rewind,_history){var swipe=this._options.swipe;if(swipe||!(this._queue.length>3||!1===index||!this._options.queue&&this._queue.stalled)){if(index=M.max(0,M.min(parseInt(index,10),this.getDataLength()-1)),rewind=void 0!==rewind?!!rewind:index<this.getIndex(),!(_history=_history||!1)&&Galleria.History)return void Galleria.History.set(index.toString());if(this.finger&&index!==this._active&&(this.finger.to=-index*this.finger.width,this.finger.index=index),this._active=index,swipe){var data=this.getData(index),self=this;if(!data)return;var src=this.isFullscreen()&&data.big?data.big:data.image||data.iframe,image=this._controls.slides[index],cached=image.isCached(src),thumb=this._thumbnails[index],evObj={cached:cached,index:index,rewind:rewind,imageTarget:image.image,thumbTarget:thumb.image,galleriaData:data};this.trigger($.extend(evObj,{type:Galleria.LOADSTART})),self.$("container").removeClass("videoplay");var complete=function(){self._layers[index].innerHTML=self.getData().layer||"",self.trigger($.extend(evObj,{type:Galleria.LOADFINISH})),self._playCheck()};self._preload(),window.setTimeout(function(){image.ready&&$(image.image).attr("src")==src?(self.trigger($.extend(evObj,{type:Galleria.IMAGE})),complete()):(data.iframe&&!data.image&&(image.isIframe=!0),image.load(src,function(image){evObj.imageTarget=image.image,self._scaleImage(image,complete).trigger($.extend(evObj,{type:Galleria.IMAGE})),complete()}))},100)}else protoArray.push.call(this._queue,{index:index,rewind:rewind}),this._queue.stalled||this._show();return this}},_show:function(){var self=this,queue=this._queue[0],data=this.getData(queue.index);if(data){var src=this.isFullscreen()&&data.big?data.big:data.image||data.iframe,active=this._controls.getActive(),next=this._controls.getNext(),cached=next.isCached(src),thumb=this._thumbnails[queue.index],mousetrigger=function(){$(next.image).trigger("mouseup")};self.$("container").toggleClass("iframe",!!data.isIframe).removeClass("videoplay");var complete=function(data,next,active,queue,thumb){return function(){var win;_transitions.active=!1,Utils.toggleQuality(next.image,self._options.imageQuality),self._layers[self._controls.active].innerHTML="",$(active.container).css({zIndex:0,opacity:0}).show(),$(active.container).find("iframe, .galleria-videoicon").remove(),$(self._controls.frames[self._controls.active].container).hide(),$(next.container).css({zIndex:1,left:0,top:0}).show(),self._controls.swap(),self._options.imagePan&&self.addPan(next.image),(data.iframe&&data.image||data.link||self._options.lightbox||self._options.clicknext)&&$(next.image).css({cursor:"pointer"}).on("mouseup",function(e){if(!("number"==typeof e.which&&e.which>1)){if(data.iframe){self.isPlaying()&&self.pause();var frame=self._controls.frames[self._controls.active],w=self._stageWidth,h=self._stageHeight;return $(frame.container).css({width:w,height:h,opacity:0}).show().animate({opacity:1},200),void window.setTimeout(function(){frame.load(data.iframe+(data.video?"&autoplay=1":""),{width:w,height:h},function(frame){self.$("container").addClass("videoplay"),frame.scale({width:self._stageWidth,height:self._stageHeight,iframelimit:data.video?self._options.maxVideoSize:undef})})},100)}return self._options.clicknext&&!Galleria.TOUCH?(self._options.pauseOnInteraction&&self.pause(),void self.next()):data.link?void(self._options.popupLinks?win=window.open(data.link,"_blank"):window.location.href=data.link):void(self._options.lightbox&&self.openLightbox())}}),self._playCheck(),self.trigger({type:Galleria.IMAGE,index:queue.index,imageTarget:next.image,thumbTarget:thumb.image,galleriaData:data}),protoArray.shift.call(self._queue),self._queue.stalled=!1,self._queue.length&&self._show()}}(data,next,active,queue,thumb);this._options.carousel&&this._options.carouselFollow&&this._carousel.follow(queue.index),self._preload(),Utils.show(next.container),next.isIframe=data.iframe&&!data.image,$(self._thumbnails[queue.index].container).addClass("active").siblings(".active").removeClass("active"),self.trigger({type:Galleria.LOADSTART,cached:cached,index:queue.index,rewind:queue.rewind,imageTarget:next.image,thumbTarget:thumb.image,galleriaData:data}),self._queue.stalled=!0,next.load(src,function(next){var layer=$(self._layers[1-self._controls.active]).html(data.layer||"").hide();self._scaleImage(next,{complete:function(next){"image"in active&&Utils.toggleQuality(active.image,!1),Utils.toggleQuality(next.image,!1),self.removePan(),self.setInfo(queue.index),self.setCounter(queue.index),data.layer&&(layer.show(),(data.iframe&&data.image||data.link||self._options.lightbox||self._options.clicknext)&&layer.css("cursor","pointer").off("mouseup").mouseup(mousetrigger)),data.video&&data.image&&_playIcon(next.container);var transition=self._options.transition;if($.each({initial:null===active.image,touch:Galleria.TOUCH,fullscreen:self.isFullscreen()},function(type,arg){if(arg&&self._options[type+"Transition"]!==undef)return transition=self._options[type+"Transition"],!1}),transition in _transitions.effects==0)complete();else{var params={prev:active.container,next:next.container,rewind:queue.rewind,speed:self._options.transitionSpeed||400};_transitions.active=!0,_transitions.init.call(self,transition,params,complete)}self.trigger({type:Galleria.LOADFINISH,cached:cached,index:queue.index,rewind:queue.rewind,imageTarget:next.image,thumbTarget:self._thumbnails[queue.index].image,galleriaData:self.getData(queue.index)})}})})}},getNext:function(base){return base="number"==typeof base?base:this.getIndex(),base===this.getDataLength()-1?0:base+1},getPrev:function(base){return base="number"==typeof base?base:this.getIndex(),0===base?this.getDataLength()-1:base-1},next:function(){return this.getDataLength()>1&&this.show(this.getNext(),!1),this},prev:function(){return this.getDataLength()>1&&this.show(this.getPrev(),!0),this},get:function(elemId){return elemId in this._dom?this._dom[elemId]:null},getData:function(index){return index in this._data?this._data[index]:this._data[this._active]},getDataLength:function(){return this._data.length},getIndex:function(){return"number"==typeof this._active&&this._active},getStageHeight:function(){return this._stageHeight},getStageWidth:function(){return this._stageWidth},getOptions:function(key){return void 0===key?this._options:this._options[key]},setOptions:function(key,value){return"object"==typeof key?$.extend(this._options,key):this._options[key]=value,this},play:function(delay){return this._playing=!0,this._playtime=delay||this._playtime,this._playCheck(),this.trigger(Galleria.PLAY),this},pause:function(){return this._playing=!1,this.trigger(Galleria.PAUSE),this},playToggle:function(delay){return this._playing?this.pause():this.play(delay)},isPlaying:function(){return this._playing},isFullscreen:function(){return this._fullscreen.active},_playCheck:function(){var self=this,played=0,interval=20,now=Utils.timestamp(),timer_id="play"+this._id;if(this._playing){this.clearTimer(timer_id);var fn=function(){if((played=Utils.timestamp()-now)>=self._playtime&&self._playing)return self.clearTimer(timer_id),void self.next();self._playing&&(self.trigger({type:Galleria.PROGRESS,percent:M.ceil(played/self._playtime*100),seconds:M.floor(played/1e3),milliseconds:played}),self.addTimer(timer_id,fn,interval))};self.addTimer(timer_id,fn,interval)}},setPlaytime:function(delay){return this._playtime=delay,this},setIndex:function(val){return this._active=val,this},setCounter:function(index){if("number"==typeof index?index++:void 0===index&&(index=this.getIndex()+1),this.get("current").innerHTML=index,IE){var count=this.$("counter"),opacity=count.css("opacity");1===parseInt(opacity,10)?Utils.removeAlpha(count[0]):this.$("counter").css("opacity",opacity)}return this},setInfo:function(index){var self=this,data=this.getData(index);return $.each(["title","description"],function(i,type){var elem=self.$("info-"+type);data[type]?elem[data[type].length?"show":"hide"]().html(data[type]):elem.empty().hide()}),this},hasInfo:function(index){var i,check="title description".split(" ");for(i=0;check[i];i++)if(this.getData(index)[check[i]])return!0;return!1},jQuery:function(str){var self=this,ret=[];$.each(str.split(","),function(i,elemId){elemId=$.trim(elemId),self.get(elemId)&&ret.push(elemId)});var jQ=$(self.get(ret.shift()));return $.each(ret,function(i,elemId){jQ=jQ.add(self.get(elemId))}),jQ},$:function(str){return this.jQuery.apply(this,Utils.array(arguments))}},$.each(_events,function(i,ev){var type=/_/.test(ev)?ev.replace(/_/g,""):ev;Galleria[ev.toUpperCase()]="galleria."+type}),$.extend(Galleria,{IE9:9===IE,IE8:8===IE,IE7:7===IE,IE6:6===IE,IE:IE,WEBKIT:/webkit/.test(NAV),CHROME:/chrome/.test(NAV),SAFARI:/safari/.test(NAV)&&!/chrome/.test(NAV),QUIRK:IE&&doc.compatMode&&"BackCompat"===doc.compatMode,MAC:/mac/.test(navigator.platform.toLowerCase()),OPERA:!!window.opera,IPHONE:/iphone/.test(NAV),IPAD:/ipad/.test(NAV),ANDROID:/android/.test(NAV),TOUCH:"ontouchstart"in doc}),Galleria.addTheme=function(theme){theme.name||Galleria.raise("No theme name specified"),"object"!=typeof theme.defaults?theme.defaults={}:theme.defaults=_legacyOptions(theme.defaults);var reg,css=!1;return"string"==typeof theme.css?($("link").each(function(i,link){if(reg=new RegExp(theme.css),reg.test(link.href))return css=!0,_themeLoad(theme),!1}),css||$(function(){var retryCount=0,tryLoadCss=function(){$("script").each(function(i,script){reg=new RegExp("galleria\\."+theme.name.toLowerCase()+"\\."),reg.test(script.src)&&(css=script.src.replace(/[^\/]*$/,"")+theme.css,window.setTimeout(function(){Utils.loadCSS(css,"galleria-theme-"+theme.name,function(){_themeLoad(theme)})},1))}),css||(retryCount++>5?Galleria.raise("No theme CSS loaded"):window.setTimeout(tryLoadCss,500))};tryLoadCss()})):_themeLoad(theme),theme},Galleria.loadTheme=function(src,options){if(!$("script").filter(function(){return $(this).attr("src")==src}).length){var err,loaded=!1;return $(window).load(function(){loaded||(err=window.setTimeout(function(){loaded||Galleria.raise("Galleria had problems loading theme at "+src+". Please check theme path or load manually.",!0)},2e4))}),Utils.loadScript(src,function(){loaded=!0,window.clearTimeout(err)}),Galleria}},Galleria.get=function(index){return _instances[index]?_instances[index]:"number"!=typeof index?_instances:void Galleria.raise("Gallery index "+index+" not found")},Galleria.configure=function(key,value){var opts={};return"string"==typeof key&&value?(opts[key]=value,key=opts):$.extend(opts,key),Galleria.configure.options=opts,$.each(Galleria.get(),function(i,instance){instance.setOptions(opts)}),Galleria},Galleria.configure.options={},Galleria.on=function(type,callback){if(type){callback=callback||F;var hash=type+callback.toString().replace(/\s/g,"")+Utils.timestamp();return $.each(Galleria.get(),function(i,instance){instance._binds.push(hash),instance.bind(type,callback)}),Galleria.on.binds.push({type:type,callback:callback,hash:hash}),Galleria}},Galleria.on.binds=[],Galleria.run=function(selector,options){return $.isFunction(options)&&(options={extend:options}),$(selector||"#galleria").galleria(options),Galleria},Galleria.addTransition=function(name,fn){return _transitions.effects[name]=fn,Galleria},Galleria.utils=Utils,Galleria.log=function(){var args=Utils.array(arguments);if(!("console"in window&&"log"in window.console))return window.alert(args.join("<br>"));try{return window.console.log.apply(window.console,args)}catch(e){$.each(args,function(){window.console.log(this)})}},Galleria.ready=function(fn){return"function"!=typeof fn?Galleria:($.each(_galleries,function(i,gallery){fn.call(gallery,gallery._options)}),Galleria.ready.callbacks.push(fn),Galleria)},Galleria.ready.callbacks=[],Galleria.raise=function(msg,fatal){var type=fatal?"Fatal error":"Error",css={color:"#fff",position:"absolute",top:0,left:0,zIndex:1e5},echo=function(msg){var html='<div style="padding:4px;margin:0 0 2px;background:#'+(fatal?"811":"222")+';">'+(fatal?"<strong>"+type+": </strong>":"")+msg+"</div>";$.each(_instances,function(){var cont=this.$("errors"),target=this.$("target");cont.length||(target.css("position","relative"),cont=this.addElement("errors").appendChild("target","errors").$("errors").css(css)),cont.append(html)}),_instances.length||$("<div>").css($.extend(css,{position:"fixed"})).append(html).appendTo(DOM().body)};if(DEBUG){if(echo(msg),fatal)throw new Error(type+": "+msg)}else if(fatal){if(_hasError)return;_hasError=!0,fatal=!1,echo("Gallery could not load.")}},Galleria.version=1.41,Galleria.getLoadedThemes=function(){return $.map(_loadedThemes,function(theme){return theme.name})},Galleria.requires=function(version,msg){return msg=msg||"You need to upgrade Galleria to version "+version+" to use one or more components.",Galleria.version<version&&Galleria.raise(msg,!0),Galleria},Galleria.Picture=function(id){this.id=id||null,this.image=null,this.container=Utils.create("galleria-image"),$(this.container).css({overflow:"hidden",position:"relative"}),this.original={width:0,height:0},this.ready=!1,this.isIframe=!1},Galleria.Picture.prototype={cache:{},show:function(){Utils.show(this.image)},hide:function(){Utils.moveOut(this.image)},clear:function(){this.image=null},isCached:function(src){return!!this.cache[src]},preload:function(src){$(new Image).load(function(src,cache){return function(){cache[src]=src}}(src,this.cache)).attr("src",src)},load:function(src,size,callback){if("function"==typeof size&&(callback=size,size=null),this.isIframe){var id="if"+(new Date).getTime(),iframe=this.image=$("<iframe>",{src:src,frameborder:0,id:id,allowfullscreen:!0,css:{visibility:"hidden"}})[0];return size&&$(iframe).css(size),$(this.container).find("iframe,img").remove(),this.container.appendChild(this.image),$("#"+id).load(function(self,callback){return function(){window.setTimeout(function(){$(self.image).css("visibility","visible"),"function"==typeof callback&&callback.call(self,self)},10)}}(this,callback)),this.container}this.image=new Image,Galleria.IE8&&$(this.image).css("filter","inherit"),Galleria.IE||Galleria.CHROME||Galleria.SAFARI||$(this.image).css("image-rendering","optimizequality");var reload=!1,resort=!1,$container=$(this.container),$image=$(this.image),onerror=function(){reload?DUMMY?$(this).attr("src",DUMMY):Galleria.raise("Image not found: "+src):(reload=!0,window.setTimeout(function(image,src){return function(){image.attr("src",src+(src.indexOf("?")>-1?"&":"?")+Utils.timestamp())}}($(this),src),50))},onload=function(self,callback,src){return function(){var complete=function(){$(this).off("load"),self.original=size||{height:this.height,width:this.width},Galleria.HAS3D&&(this.style.MozTransform=this.style.webkitTransform="translate3d(0,0,0)"),$container.append(this),self.cache[src]=src,"function"==typeof callback&&window.setTimeout(function(){callback.call(self,self)},1)};this.width&&this.height?complete.call(this):function(img){Utils.wait({until:function(){return img.width&&img.height},success:function(){complete.call(img)},error:function(){resort?Galleria.raise("Could not extract width/height from image: "+img.src+". Traced measures: width:"+img.width+"px, height: "+img.height+"px."):($(new Image).load(onload).attr("src",img.src),resort=!0)},timeout:100})}(this)}}(this,callback,src);return $container.find("iframe,img").remove(),$image.css("display","block"),Utils.hide(this.image),$.each("minWidth minHeight maxWidth maxHeight".split(" "),function(i,prop){$image.css(prop,/min/.test(prop)?"0":"none")}),$image.load(onload).on("error",onerror).attr("src",src),this.container},scale:function(options){var self=this;if(options=$.extend({width:0,height:0,min:undef,max:undef,margin:0,complete:F,position:"center",crop:!1,canvas:!1,iframelimit:undef},options),this.isIframe){var nw,nh,cw=options.width,ch=options.height;if(options.iframelimit){var r=M.min(options.iframelimit/cw,options.iframelimit/ch);r<1?(nw=cw*r,nh=ch*r,$(this.image).css({top:ch/2-nh/2,left:cw/2-nw/2,position:"absolute"})):$(this.image).css({top:0,left:0})}$(this.image).width(nw||cw).height(nh||ch).removeAttr("width").removeAttr("height"),$(this.container).width(cw).height(ch),options.complete.call(self,self);try{this.image.contentWindow&&$(this.image.contentWindow).trigger("resize")}catch(e){}return this.container}if(!this.image)return this.container;var width,height,data,$container=$(self.container);return Utils.wait({until:function(){return width=options.width||$container.width()||Utils.parseValue($container.css("width")),height=options.height||$container.height()||Utils.parseValue($container.css("height")),width&&height},success:function(){var newWidth=(width-2*options.margin)/self.original.width,newHeight=(height-2*options.margin)/self.original.height,min=M.min(newWidth,newHeight),max=M.max(newWidth,newHeight),cropMap={true:max,width:newWidth,height:newHeight,false:min,landscape:self.original.width>self.original.height?max:min,portrait:self.original.width<self.original.height?max:min},ratio=cropMap[options.crop.toString()],canvasKey="";options.max&&(ratio=M.min(options.max,ratio)),options.min&&(ratio=M.max(options.min,ratio)),$.each(["width","height"],function(i,m){$(self.image)[m](self[m]=self.image[m]=M.round(self.original[m]*ratio))}),$(self.container).width(width).height(height),options.canvas&&_canvas&&(_canvas.elem.width=self.width,_canvas.elem.height=self.height,canvasKey=self.image.src+":"+self.width+"x"+self.height,self.image.src=_canvas.cache[canvasKey]||function(key){_canvas.context.drawImage(self.image,0,0,self.original.width*ratio,self.original.height*ratio);try{return data=_canvas.elem.toDataURL(),_canvas.length+=data.length,_canvas.cache[key]=data,data}catch(e){return self.image.src}}(canvasKey));var pos={},mix={},getPosition=function(value,measure,margin){var result=0;if(/\%/.test(value)){var flt=parseInt(value,10)/100,m=self.image[measure]||$(self.image)[measure]();result=M.ceil(-1*m*flt+margin*flt)}else result=Utils.parseValue(value);return result},positionMap={top:{top:0},left:{left:0},right:{left:"100%"},bottom:{top:"100%"}};$.each(options.position.toLowerCase().split(" "),function(i,value){"center"===value&&(value="50%"),pos[i?"top":"left"]=value}),$.each(pos,function(i,value){positionMap.hasOwnProperty(value)&&$.extend(mix,positionMap[value])}),pos=pos.top?$.extend(pos,mix):mix,pos=$.extend({top:"50%",left:"50%"},pos),$(self.image).css({position:"absolute",top:getPosition(pos.top,"height",height),left:getPosition(pos.left,"width",width)}),self.show(),self.ready=!0,options.complete.call(self,self)},error:function(){Galleria.raise("Could not scale image: "+self.image.src)},timeout:1e3}),this}},$.extend($.easing,{galleria:function(_,t,b,c,d){return(t/=d/2)<1?c/2*t*t*t+b:c/2*((t-=2)*t*t+2)+b},galleriaIn:function(_,t,b,c,d){return c*(t/=d)*t+b},galleriaOut:function(_,t,b,c,d){return-c*(t/=d)*(t-2)+b}}),Galleria.Finger=function(){var has3d=(M.abs,Galleria.HAS3D=function(){var has3d,s,el=doc.createElement("p"),t=["webkit","O","ms","Moz",""],i=0,a="transform";for(DOM().html.insertBefore(el,null);t[i];i++)s=t[i]?t[i]+"Transform":a,void 0!==el.style[s]&&(el.style[s]="translate3d(1px,1px,1px)",has3d=$(el).css(t[i]?"-"+t[i].toLowerCase()+"-"+a:a));return DOM().html.removeChild(el),void 0!==has3d&&has3d.length>0&&"none"!==has3d}()),requestFrame=function(){var r="RequestAnimationFrame";return window.requestAnimationFrame||window["webkit"+r]||window["moz"+r]||window["o"+r]||window["ms"+r]||function(callback){window.setTimeout(callback,1e3/60)}}(),Finger=function(elem,options){if(this.config={start:0,duration:500,onchange:function(){},oncomplete:function(){},easing:function(x,t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b}},this.easeout=function(x,t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b},elem.children.length){var self=this;$.extend(this.config,options),this.elem=elem,this.child=elem.children[0],this.to=this.pos=0,this.touching=!1,this.start={},this.index=this.config.start,this.anim=0,this.easing=this.config.easing,has3d||(this.child.style.position="absolute",this.elem.style.position="relative"),$.each(["ontouchstart","ontouchmove","ontouchend","setup"],function(i,fn){self[fn]=function(caller){return function(){caller.apply(self,arguments)}}(self[fn])}),this.setX=function(){var style=self.child.style;if(!has3d)return void(style.left=self.pos+"px");style.MozTransform=style.webkitTransform=style.transform="translate3d("+self.pos+"px,0,0)"},$(elem).on("touchstart",this.ontouchstart),$(window).on("resize",this.setup),$(window).on("orientationchange",this.setup),this.setup(),function animloop(){requestFrame(animloop),self.loop.call(self)}()}};return Finger.prototype={constructor:Finger,setup:function(){this.width=$(this.elem).width(),this.length=M.ceil($(this.child).width()/this.width),0!==this.index&&(this.index=M.max(0,M.min(this.index,this.length-1)),this.pos=this.to=-this.width*this.index)},setPosition:function(pos){this.pos=pos,this.to=pos},ontouchstart:function(e){var touch=e.originalEvent.touches;this.start={pageX:touch[0].pageX,pageY:touch[0].pageY,time:+new Date},this.isScrolling=null,this.touching=!0,this.deltaX=0,$doc.on("touchmove",this.ontouchmove),$doc.on("touchend",this.ontouchend)},ontouchmove:function(e){var touch=e.originalEvent.touches;touch&&touch.length>1||e.scale&&1!==e.scale||(this.deltaX=touch[0].pageX-this.start.pageX,null===this.isScrolling&&(this.isScrolling=!!(this.isScrolling||M.abs(this.deltaX)<M.abs(touch[0].pageY-this.start.pageY))),this.isScrolling||(e.preventDefault(),this.deltaX/=!this.index&&this.deltaX>0||this.index==this.length-1&&this.deltaX<0?M.abs(this.deltaX)/this.width+1.8:1,this.to=this.deltaX-this.index*this.width),e.stopPropagation())},ontouchend:function(e){this.touching=!1;var isValidSlide=+new Date-this.start.time<250&&M.abs(this.deltaX)>40||M.abs(this.deltaX)>this.width/2,isPastBounds=!this.index&&this.deltaX>0||this.index==this.length-1&&this.deltaX<0;this.isScrolling||this.show(this.index+(isValidSlide&&!isPastBounds?this.deltaX<0?1:-1:0)),$doc.off("touchmove",this.ontouchmove),$doc.off("touchend",this.ontouchend)},show:function(index){index!=this.index?this.config.onchange.call(this,index):this.to=-index*this.width},moveTo:function(index){index!=this.index&&(this.pos=this.to=-index*this.width,this.index=index)},loop:function(){var distance=this.to-this.pos,factor=1;if(this.width&&distance&&(factor=M.max(.5,M.min(1.5,M.abs(distance/this.width)))),this.touching||M.abs(distance)<=1)this.pos=this.to,distance=0,this.anim&&!this.touching&&this.config.oncomplete(this.index),this.anim=0,this.easing=this.config.easing;else{this.anim||(this.anim={start:this.pos,time:+new Date,distance:distance,factor:factor,destination:this.to});var elapsed=+new Date-this.anim.time,duration=this.config.duration*this.anim.factor;if(elapsed>duration||this.anim.destination!=this.to)return this.anim=0,void(this.easing=this.easeout);this.pos=this.easing(null,elapsed,this.anim.start,this.anim.distance,duration)}this.setX()}},Finger}(),$.fn.galleria=function(options){var selector=this.selector;return $(this).length?this.each(function(){$.data(this,"galleria")&&($.data(this,"galleria").destroy(),$(this).find("*").hide()),$.data(this,"galleria",(new Galleria).init(this,options))}):($(function(){$(selector).length?$(selector).galleria(options):Galleria.utils.wait({until:function(){return $(selector).length},success:function(){$(selector).galleria(options)},error:function(){Galleria.raise('Init failed: Galleria could not find the element "'+selector+'".')},timeout:5e3})}),this)},"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=Galleria:(window.Galleria=Galleria,"function"==typeof define&&define.amd&&define("galleria",["jquery"],function(){return Galleria}))}(jQuery,this),function($){"use strict";function getParent($this){var selector=$this.attr("data-target");selector||(selector=$this.attr("href"),selector=selector&&/#[A-Za-z]/.test(selector)&&selector.replace(/.*(?=#[^\s]*$)/,""));var $parent=selector&&$(selector);return $parent&&$parent.length?$parent:$this.parent()}function clearMenus(e){e&&3===e.which||($(backdrop).remove(),$(toggle).each(function(){var $this=$(this),$parent=getParent($this),relatedTarget={relatedTarget:this};$parent.hasClass("open")&&(e&&"click"==e.type&&/input|textarea/i.test(e.target.tagName)&&$.contains($parent[0],e.target)||($parent.trigger(e=$.Event("hide.bs.dropdown",relatedTarget)),e.isDefaultPrevented()||($this.attr("aria-expanded","false"),$parent.removeClass("open").trigger($.Event("hidden.bs.dropdown",relatedTarget)))))}))}function Plugin(option){return this.each(function(){var $this=$(this),data=$this.data("bs.dropdown");data||$this.data("bs.dropdown",data=new Dropdown(this)),"string"==typeof option&&data[option].call($this)})}var backdrop=".dropdown-backdrop",toggle='[data-toggle="dropdown"]',Dropdown=function(element){$(element).on("click.bs.dropdown",this.toggle)};Dropdown.VERSION="3.3.7",Dropdown.prototype.toggle=function(e){var $this=$(this);if(!$this.is(".disabled, :disabled")){var $parent=getParent($this),isActive=$parent.hasClass("open");if(clearMenus(),!isActive){"ontouchstart"in document.documentElement&&!$parent.closest(".navbar-nav").length&&$(document.createElement("div")).addClass("dropdown-backdrop").insertAfter($(this)).on("click",clearMenus);var relatedTarget={relatedTarget:this};if($parent.trigger(e=$.Event("show.bs.dropdown",relatedTarget)),e.isDefaultPrevented())return;$this.trigger("focus").attr("aria-expanded","true"),$parent.toggleClass("open").trigger($.Event("shown.bs.dropdown",relatedTarget))}return!1}},Dropdown.prototype.keydown=function(e){if(/(38|40|27|32)/.test(e.which)&&!/input|textarea/i.test(e.target.tagName)){var $this=$(this);if(e.preventDefault(),e.stopPropagation(),!$this.is(".disabled, :disabled")){var $parent=getParent($this),isActive=$parent.hasClass("open");if(!isActive&&27!=e.which||isActive&&27==e.which)return 27==e.which&&$parent.find(toggle).trigger("focus"),$this.trigger("click");var desc=" li:not(.disabled):visible a",$items=$parent.find(".dropdown-menu"+desc);if($items.length){var index=$items.index(e.target);38==e.which&&index>0&&index--,40==e.which&&index<$items.length-1&&index++,~index||(index=0),$items.eq(index).trigger("focus")}}}};var old=$.fn.dropdown;$.fn.dropdown=Plugin,$.fn.dropdown.Constructor=Dropdown,$.fn.dropdown.noConflict=function(){return $.fn.dropdown=old,this},$(document).on("click.bs.dropdown.data-api",clearMenus).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",toggle,Dropdown.prototype.toggle).on("keydown.bs.dropdown.data-api",toggle,Dropdown.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",Dropdown.prototype.keydown)}(jQuery),function($){"use strict";function getTargetFromTrigger($trigger){var href,target=$trigger.attr("data-target")||(href=$trigger.attr("href"))&&href.replace(/.*(?=#[^\s]+$)/,"");return $(target)}function Plugin(option){return this.each(function(){var $this=$(this),data=$this.data("bs.collapse"),options=$.extend({},Collapse.DEFAULTS,$this.data(),"object"==typeof option&&option);!data&&options.toggle&&/show|hide/.test(option)&&(options.toggle=!1),data||$this.data("bs.collapse",data=new Collapse(this,options)),"string"==typeof option&&data[option]()})}var Collapse=function(element,options){this.$element=$(element),this.options=$.extend({},Collapse.DEFAULTS,options),this.$trigger=$('[data-toggle="collapse"][href="#'+element.id+'"],[data-toggle="collapse"][data-target="#'+element.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};Collapse.VERSION="3.3.7",Collapse.TRANSITION_DURATION=350,Collapse.DEFAULTS={toggle:!0},Collapse.prototype.dimension=function(){return this.$element.hasClass("width")?"width":"height"},Collapse.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var activesData,actives=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(actives&&actives.length&&(activesData=actives.data("bs.collapse"))&&activesData.transitioning)){var startEvent=$.Event("show.bs.collapse");if(this.$element.trigger(startEvent),!startEvent.isDefaultPrevented()){actives&&actives.length&&(Plugin.call(actives,"hide"),activesData||actives.data("bs.collapse",null));var dimension=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[dimension](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var complete=function(){this.$element.removeClass("collapsing").addClass("collapse in")[dimension](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!$.support.transition)return complete.call(this);var scrollSize=$.camelCase(["scroll",dimension].join("-"));this.$element.one("bsTransitionEnd",$.proxy(complete,this)).emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])}}}},Collapse.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var startEvent=$.Event("hide.bs.collapse");if(this.$element.trigger(startEvent),!startEvent.isDefaultPrevented()){var dimension=this.dimension();this.$element[dimension](this.$element[dimension]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var complete=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};if(!$.support.transition)return complete.call(this);this.$element[dimension](0).one("bsTransitionEnd",$.proxy(complete,this)).emulateTransitionEnd(Collapse.TRANSITION_DURATION)}}},Collapse.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},Collapse.prototype.getParent=function(){return $(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each($.proxy(function(i,element){var $element=$(element);this.addAriaAndCollapsedClass(getTargetFromTrigger($element),$element)},this)).end()},Collapse.prototype.addAriaAndCollapsedClass=function($element,$trigger){var isOpen=$element.hasClass("in");$element.attr("aria-expanded",isOpen),$trigger.toggleClass("collapsed",!isOpen).attr("aria-expanded",isOpen)};var old=$.fn.collapse;$.fn.collapse=Plugin,$.fn.collapse.Constructor=Collapse,$.fn.collapse.noConflict=function(){return $.fn.collapse=old,this},$(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(e){var $this=$(this);$this.attr("data-target")||e.preventDefault();var $target=getTargetFromTrigger($this),data=$target.data("bs.collapse"),option=data?"toggle":$this.data();Plugin.call($target,option)})}(jQuery),function($){"use strict";function transitionEnd(){var el=document.createElement("bootstrap"),transEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var name in transEndEventNames)if(void 0!==el.style[name])return{end:transEndEventNames[name]};return!1}$.fn.emulateTransitionEnd=function(duration){var called=!1,$el=this;$(this).one("bsTransitionEnd",function(){called=!0});var callback=function(){called||$($el).trigger($.support.transition.end)};return setTimeout(callback,duration),this},$(function(){$.support.transition=transitionEnd(),$.support.transition&&($.event.special.bsTransitionEnd={bindType:$.support.transition.end,delegateType:$.support.transition.end,handle:function(e){if($(e.target).is(this))return e.handleObj.handler.apply(this,arguments)}})})}(jQuery),jQuery(document).ready(function($){$.fn.extend({animateCss:function(animationName){this.addClass("animated "+animationName).one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("animated "+animationName)})}});var dias=$("ul.diasfilsa li a.daysel"),container=$(".eventos-load");if($("span.infoevento"))var eventcat=$("span.infoevento").data("eventcat");else var eventcat=180;dias.on("click",function(){dias.removeClass("active"),$(this).addClass("active");var dia=$(this).data("day");container.empty().append('<div class="eventos-loading"><p><i class="fa fa-cog fa-spin"></i> buscando eventos ...</p></div>'),$.ajax({type:"POST",url:cchl.ajaxurl,data:{action:"cchl_eventdayquery",day:dia,eventcat:eventcat}}).done(function(data){container.empty().append(data),cchl_enableFilters(container)})});var filtroselect=$("select#todos-eventos-tipos-ajax, select#todos-eventos-temas-ajax"),containerfiltro=$("div.evtodos-load");filtroselect.on("change",function(){var tax=$(this).data("filter"),selected=$("option:selected",this),term=selected.attr("value");containerfiltro.empty().append('<div class="eventos-loading"><p><i class="fa fa-cog fa-spin"></i> buscando eventos ...</p></div>'),$.ajax({type:"POST",url:cchl.ajaxurl,data:{action:"cchl_eventfilterquery",eventtax:tax,eventterm:term,eventcat:eventcat}}).done(function(data){containerfiltro.empty().append(data)})}),$("#searchform-eventos").on("submit",function(){var $form=$(this),$input=$form.find('input[name="s"]'),query=$input.val(),$content=$("#eventsearchresults");return $.ajax({type:"POST",url:cchl.ajaxurl,data:{action:"cchl_customeventsearch",query:query},beforeSend:function(){$input.prop("disabled",!0),$content.empty().append('<div class="eventos-loading"><p><i class="fa fa-cog fa-spin"></i> buscando eventos ...</p></div>').addClass("loading")},success:function(response){$input.prop("disabled",!1),$content.removeClass("loading"),$content.empty().html(response)}}),!1});var ferias=$(".ferias-normales").masonry({itemSelector:".feria-normal",columnWidth:300,gutter:12});ferias.imagesLoaded().progress(function(){ferias.masonry("layout")});var catitems=$(".category-items").masonry({itemSelector:".item-mini-noticia"});catitems.imagesLoaded().progress(function(){catitems.masonry("layout")});var tabContainers=$("div.tabs2 > div");tabContainers.hide().filter(":first").show(),$("div.tabs2 ul.tabNavigation a").click(function(){return tabContainers.hide(),tabContainers.filter(this.hash).show(),$("div.tabs2 ul.tabNavigation a").removeClass("selected"),$(this).addClass("selected"),!1}).filter(":first").click();var galleryCont=$(".gallery");if(Galleria.loadTheme(cchl.templateurl+"/js/extras/galleria.classic.js"),Galleria&&galleryCont.length>0&&galleryCont&&Galleria.run(".gallery"),$("body").hasClass("page-template-bs-listado-socios")||$("body").hasClass("post-type-archive-socios")){for(var i=0;i<existingletters.length;i++)$(".btn-group.nav-socios-list").append('<button class="btn btn-default">'+existingletters[i]+"</button>");$(".btn-group.nav-socios-list .btn").on("click",function(){var thisitem=$(this),thisletter=thisitem.text(),others=$(".btn-group.nav-socios-list .btn");thisitem.hasClass("btn-primary")?($(".listado-socios .item-socio").show(),thisitem.removeClass("btn-primary"),thisitem.addClass("btn-default")):($(".listado-socios .item-socio").hide(),$(".listado-socios .item-socio[data-letter="+thisletter+"]").show(),thisitem.removeClass("btn-default"),others.removeClass("btn-primary").addClass("btn-default"),thisitem.addClass("btn-primary"))})}}),jQuery(document).ready(function($){$("#faq .preg").click(function(){$(this).hasClass("activo")?$(this).removeClass("activo"):$(this).addClass("activo"),$(this).next().slideToggle()}),$(".noticias-filsa").cycle({fx:"scrollUp",speed:"slow",timeout:0,pager:"#notfilsapager",pagerAnchorBuilder:function(index,element){return console.log(index),'<a href="#"></a>'}});var sharer=$(".sharer"),durl=sharer.data("url"),fbshares=0;sharer&&$.getJSON("https://graph.facebook.com/?id="+durl,function(json){fbshares=+json.share.share_count||0,$(".sharer__facebook",sharer).append("<span>"+parseInt(fbshares)+"</span>")});var tabs=$("#tabs");$(".tab-panel",tabs).hide(),$(".tab-panel.active",tabs).show(),$(".tab-nav li a",tabs).on("click",function(element){var activetab=$(".tab-panel.active",tabs),activebutton=$(".tab-nav li.active",tabs);$(this).hasClass("active")?element.preventDefault():(element.preventDefault(),activetab.fadeOut().removeClass("active"),activebutton.removeClass("active"),$(this).parent("li").addClass("active"),$($(this).attr("href")).fadeIn().addClass("active"))})}),jQuery(document).ready(function($){$(".calendario-filsa").cycle({fx:"fade",speed:"fast",timeout:0,pager:"#navfilsa",width:"100%",pagerAnchorBuilder:function(index,element){var dia=$(element).data("dia"),ndia=$(element).data("ndia"),mes=$(element).data("mes"),hoy="otrodia";return $(element).hasClass("hoy")&&(hoy="hoy"),'<a href="#" class="'+hoy+'"><span class="dia">'+dia+' </span><span class="ndia">'+ndia+'</span><span class="mes"> '+mes+" </span></a>"},onPagerEvent:function(index,element){cchl_enableFilters(element)}}),$("ul.calendario-filsa li:first").append(function(){var eventos=$("div.evento",this);eventos.show();var avevs=[],evsarr=[],temevs=[],temsarr=[];eventos.each(function(){var evs=$(this).data("cchl_tipoevento"),tems=$(this).data("cchl_temaevento");if(void 0!==evs){evsarr=evs.split(" ");for(var i=0,l=evsarr.length;i<l;i++)-1==$.inArray(evsarr[i],avevs)&&avevs.push(evsarr[i])}if(void 0!==tems){temsarr=tems.split(" ");for(var i=0,l=temsarr.length;i<l;i++)-1==$.inArray(temsarr[i],temevs)&&temevs.push(temsarr[i])}});var filtro=$("ul.calendario-filsa li:first div.filtro"),filtrotema=$("div.filtrotema");avevs.sort(),filtro.empty();for(var i=0,l=avevs.length;i<l;i++)filtro.append('<a href="#" data-tiposw="'+avevs[i]+'">'+cchl.evtipos[avevs[i]]+"</a>");for(var i=0,l=temevs.length;i<l;i++)filtrotema.append('<a href="#" data-tiposw="'+temevs[i]+'">'+cchl.evtemas[temevs[i]]+"</a>");$("div.filtrotab",this).hide(),$("div.filtrotab.active",this).show();var lidiaaltura=$(this).height();$("ul.calendario-filsa").height(lidiaaltura)}),$("div.filtro, .eventos-load").on("click","a.fltip",function(event){$("div.filtro a").removeClass("on"),console.log("clickfiltro"),event.preventDefault();var parentdata=$(this).parent().data("id"),all=($('div.filtro[data-id="'+parentdata+'"]'),$('div.evento[data-top="'+parentdata+'"]')),thistipo=$(this).data("tiposw"),selected=$('div.evento[data-cchl_tipoevento~="'+thistipo+'"]');all.hide(),selected.show(),$(this).addClass("on")}),$("div.filtrotema, .eventos-load").on("click","a.fltem",function(event){$("div.filtrotema a").removeClass("on"),event.preventDefault();var parentdata=$(this).parent().data("id"),all=($('div.filtrotema[data-id="'+parentdata+'"]'),$('div.evento[data-top="'+parentdata+'"]')),thistipo=$(this).data("tiposw"),selected=$('div.evento[data-cchl_temaevento~="'+thistipo+'"]');all.hide(),selected.show(),$(this).addClass("on")});var firstel=$("ul.calendario-filsa li:first");$(".filtronav a",firstel).on("click",function(event){var eventos=$("div.evento",this);event.preventDefault(),eventos.show(),$("div.filtrotema a, div.filtro a",firstel).removeClass("on");var active=$(".filtronav a.active",firstel);$(".filtrotab.active",firstel).hide().removeClass("active"),active.removeClass("active"),thisdatafilter=$(this).attr("data-relfilter"),$('.filtrotab[data-filter="'+thisdatafilter+'"]',firstel).show().addClass("active"),$(this).addClass("active")});var tipos=cchl.evtipos,temas=cchl.evtemas,filtodos=$("select#todos-eventos-tipos, select#todos-eventos-temas");for(var i in tipos)tipos.hasOwnProperty(i)&&$('select#todos-eventos-tipos[data-filter="cchl_tipoevento"]').append('<option value="'+i+'">'+tipos[i]+"</option>");for(var i in temas)temas.hasOwnProperty(i)&&$('select#todos-eventos-temas[data-filter="cchl_temaevento"]').append('<option value="'+i+'">'+temas[i]+"</option>");$(".filtrotab").hide(),$(".filtrotab.active").show(),$(".filtronav.selectabs a").on("click",function(event){event.preventDefault(),$(".wraptodos h2").empty().append("Escoge un filtro"),$("div.filtrotema a, div.filtro a").removeClass("on");var active=$(".filtronav.selectabs a.active");$(".filtrotab.active").hide().removeClass("active"),active.removeClass("active"),thisdatafilter=$(this).attr("data-relfilter"),$('.filtrotab[data-filter="'+thisdatafilter+'"]').show().addClass("active"),$(this).addClass("active"),$(".wraptodos ul.calendario-filsa li").empty(),$(".selectwrap select").val(0)}),filtodos.on("change",function(event){var wraptodos=$(".wraptodos"),filtertype=$(this).data("filter"),sumheight=0;console.log(filtertype);var calappend=$("ul.calendario-filsa li",wraptodos),selected=$("option:selected",this);$("h2",wraptodos).empty(),$("h2",wraptodos).append(selected.text());var selectedevents=$("div.evento[data-"+filtertype+'~="'+selected.attr("value")+'"]');calappend.empty(),selectedevents.clone().appendTo(calappend).show(),$("ul.calendario-filsa li div.evento",wraptodos).each(function(index,element){var elemh=$(element).outerHeight();sumheight=sumheight+elemh+6}),$("ul.calendario-filsa").height(sumheight)});var tabtodos=($(".tabdias"),$(".tabtodos")),tabgratis=$(".tabgratis"),tabsearch=$(".tabsearch");tabtodos.hide(),tabgratis.hide(),tabsearch.hide(),$(".navprincipaleventos a").on("click",function(event){var datathis=$(this).data("tab"),activetab=$(".navprincipaleventos a.active");"link"==datathis?window.location($(this).attr("href")):(event.preventDefault(),activetab.removeClass("active"),$(".tabgen.active").hide().removeClass("active"),$(this).addClass("active"),$("#"+datathis).show().addClass("active"),$(".wraptodos ul.calendario-filsa li").empty(),$(".selectwrap select").val(0))}),$("body.page-id-108 #menu-item-54759").addClass("current_page_item current-menu-item"),$("#navfilsa a.hoy, #diaseventos ul li a.hoy").trigger("click"),$(".filsa-header-mobile a.triggernav").on("click",function(){var nav=$("nav.mobile-menu-filsa");nav.hasClass("inactive")?nav.removeClass("inactive").addClass("active"):nav.removeClass("active").addClass("inactive")}),$("nav.mobile-menu-filsa a").on("click",function(){console.log("inclick"),$("nav.mobile-menu-filsa").removeClass("active").addClass("inactive")}),$(".triggerfilter").on("click",function(){$(".cchl_bl_right").toggleClass("active")})});